<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>å†è¯» pinia å®˜æ–¹æ–‡æ¡£ | å‰ç«¯æŠ€æœ¯åšå®¢</title>
    <meta name="author" content="xiaosongread">
    <meta name="keywords" content="å°å®‹ æŠ¿åœªæ–—å‰ç«¯ å‰ç«¯ å‰ç«¯åšå®¢ æ¡†æ¶ å·¥ç¨‹ css html js node markdown npm webpack">
    <meta name="description" content="å®‰è£…ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨å®‰è£… piniaï¼š123yarn add pinia# æˆ–è€…ä½¿ç”¨ npmnpm install piniaå¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨çš„ Vue ç‰ˆæœ¬ä½äº 2.7ï¼Œä½ è¿˜éœ€è¦å®‰è£…ç»„åˆå¼ API åŒ…ï¼š@vue/composition-apiã€‚åˆ›å»ºä¸€ä¸ª pinia å®ä¾‹åˆ›å»ºä¸€ä¸ª pinia å®ä¾‹ (æ ¹ store) å¹¶å°†å…¶ä¼ é€’ç»™åº”ç”¨ï¼š123456789import &amp;#123; createApp &amp;#125; from &#39;vue&#39;import &amp;#123; create...">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="/atom.xml" title="å‰ç«¯æŠ€æœ¯åšå®¢" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    <link rel="stylesheet" href="/css/style.css">

    <!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
</head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">å‰ç«¯æŠ€æœ¯åšå®¢</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">åˆ—è¡¨</span>
            </a>
        
            <a class="nav-item" href="/">
                <span class="nav-text">é¦–é¡µ</span>
            </a>
        
            <a class="nav-item" href="/categories/css-end/">
                <span class="nav-text">css</span>
            </a>
        
            <a class="nav-item" href="/categories/js-end/">
                <span class="nav-text">js</span>
            </a>
        
            <a class="nav-item" href="/categories/gc-end/">
                <span class="nav-text">å·¥ç¨‹</span>
            </a>
        
            <a class="nav-item" href="/categories/sh-end/">
                <span class="nav-text">æ—¥å¸¸</span>
            </a>
        
            <a class="nav-item" href="/categories/my-end/">
                <span class="nav-text">å…³äºæˆ‘</span>
            </a>
        
    </nav>
</div>

    
<aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å®‰è£…"><span class="toc-number">1.</span> <span class="toc-text">å®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆ›å»ºä¸€ä¸ª-pinia-å®ä¾‹"><span class="toc-number">1.1.</span> <span class="toc-text">åˆ›å»ºä¸€ä¸ª pinia å®ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-Store"><span class="toc-number">1.2.</span> <span class="toc-text">åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Store?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Store"><span class="toc-number">1.3.</span> <span class="toc-text">ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ Store?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®šä¹‰-Store"><span class="toc-number">2.</span> <span class="toc-text">å®šä¹‰ Store</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Option-Store"><span class="toc-number">2.1.</span> <span class="toc-text">Option Store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Store"><span class="toc-number">2.2.</span> <span class="toc-text">Setup Store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ"><span class="toc-number">2.3.</span> <span class="toc-text">ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-Store"><span class="toc-number">2.4.</span> <span class="toc-text">ä½¿ç”¨ Store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä»-Store-è§£æ„-storeToRefs"><span class="toc-number">2.5.</span> <span class="toc-text">ä» Store è§£æ„ - storeToRefs()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#state"><span class="toc-number">3.</span> <span class="toc-text">state</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeScript"><span class="toc-number">3.1.</span> <span class="toc-text">TypeScript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è®¿é—®-state"><span class="toc-number">3.2.</span> <span class="toc-text">è®¿é—® state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é‡ç½®state"><span class="toc-number">3.3.</span> <span class="toc-text">é‡ç½®state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•"><span class="toc-number">3.4.</span> <span class="toc-text">ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å¯ä¿®æ”¹çš„-state"><span class="toc-number">3.4.1.</span> <span class="toc-text">å¯ä¿®æ”¹çš„ state</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å˜æ›´-state-patch"><span class="toc-number">3.5.</span> <span class="toc-text">å˜æ›´ state - $patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ›¿æ¢-state"><span class="toc-number">3.6.</span> <span class="toc-text">æ›¿æ¢ state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è®¢é˜…-state-subscribe"><span class="toc-number">3.7.</span> <span class="toc-text">è®¢é˜… state - $subscribe()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆ·æ–°æ—¶æœº"><span class="toc-number">3.8.</span> <span class="toc-text">åˆ·æ–°æ—¶æœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å–æ¶ˆè®¢é˜…"><span class="toc-number">3.9.</span> <span class="toc-text">å–æ¶ˆè®¢é˜…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getter"><span class="toc-number">4.</span> <span class="toc-text">Getter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#è®¿é—®å…¶ä»–-getter"><span class="toc-number">4.1.</span> <span class="toc-text">è®¿é—®å…¶ä»– getter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å‘-getter-ä¼ é€’å‚æ•°"><span class="toc-number">4.2.</span> <span class="toc-text">å‘ getter ä¼ é€’å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è®¿é—®å…¶ä»–-store-çš„-getter"><span class="toc-number">4.3.</span> <span class="toc-text">è®¿é—®å…¶ä»– store çš„ getter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-setup-æ—¶çš„ç”¨æ³•"><span class="toc-number">4.4.</span> <span class="toc-text">ä½¿ç”¨ setup() æ—¶çš„ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•-1"><span class="toc-number">4.5.</span> <span class="toc-text">ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Action"><span class="toc-number">5.</span> <span class="toc-text">Action</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#è®¿é—®å…¶ä»–-store-çš„-action"><span class="toc-number">5.1.</span> <span class="toc-text">è®¿é—®å…¶ä»– store çš„ action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•-2"><span class="toc-number">5.2.</span> <span class="toc-text">ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è®¢é˜…-action"><span class="toc-number">5.3.</span> <span class="toc-text">è®¢é˜… action</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ’ä»¶"><span class="toc-number">6.</span> <span class="toc-text">æ’ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ç®€ä»‹"><span class="toc-number">6.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‰©å±•-store"><span class="toc-number">6.2.</span> <span class="toc-text">æ‰©å±• store</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åœ¨ç»„ä»¶å¤–ä½¿ç”¨-store"><span class="toc-number">7.</span> <span class="toc-text">åœ¨ç»„ä»¶å¤–ä½¿ç”¨ store</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å•é¡µé¢åº”ç”¨"><span class="toc-number">7.1.</span> <span class="toc-text">å•é¡µé¢åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨"><span class="toc-number">7.2.</span> <span class="toc-text">æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æœåŠ¡ç«¯æ¸²æŸ“-SSR"><span class="toc-number">8.</span> <span class="toc-text">æœåŠ¡ç«¯æ¸²æŸ“ (SSR)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åœ¨-setup-å¤–éƒ¨ä½¿ç”¨-store"><span class="toc-number">8.1.</span> <span class="toc-text">åœ¨ setup() å¤–éƒ¨ä½¿ç”¨ store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#State-æ¿€æ´»"><span class="toc-number">8.2.</span> <span class="toc-text">State æ¿€æ´»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nuxt"><span class="toc-number">8.3.</span> <span class="toc-text">Nuxt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å®‰è£…-1"><span class="toc-number">8.3.1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åœ¨-setup-å¤–éƒ¨ä½¿ç”¨-store-1"><span class="toc-number">8.3.2.</span> <span class="toc-text">åœ¨ setup() å¤–éƒ¨ä½¿ç”¨ store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#è‡ªåŠ¨å¼•å…¥"><span class="toc-number">8.3.3.</span> <span class="toc-text">è‡ªåŠ¨å¼•å…¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#çº¯-Nuxt-2"><span class="toc-number">8.3.4.</span> <span class="toc-text">çº¯ Nuxt 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pinia-æ­é…-Vuex-ä½¿ç”¨"><span class="toc-number">8.3.5.</span> <span class="toc-text">Pinia æ­é… Vuex ä½¿ç”¨</span></a></li></ol></li></ol></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            å†è¯» pinia å®˜æ–¹æ–‡æ¡£
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://www.shuy.cc/2025/06/10/pina/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2025-06-10T08:45:53.000Z" itemprop="datePublished">2025-06-10</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨å®‰è£… <code>pinia</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add pinia</span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ npm</span></span><br><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨çš„ Vue ç‰ˆæœ¬ä½äº <code>2.7</code>ï¼Œä½ è¿˜éœ€è¦å®‰è£…ç»„åˆå¼ API åŒ…ï¼š<code>@vue/composition-api</code>ã€‚</p>
</blockquote>
<h3 id="åˆ›å»ºä¸€ä¸ª-pinia-å®ä¾‹"><a href="#åˆ›å»ºä¸€ä¸ª-pinia-å®ä¾‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ª pinia å®ä¾‹"></a><strong>åˆ›å»ºä¸€ä¸ª pinia å®ä¾‹</strong></h3><a id="more"></a>
<p>åˆ›å»ºä¸€ä¸ª pinia å®ä¾‹ (æ ¹ store) å¹¶å°†å…¶ä¼ é€’ç»™åº”ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">app.use(pinia)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>Vue 2</code>ï¼Œä½ è¿˜éœ€è¦å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼Œå¹¶åœ¨åº”ç”¨çš„æ ¹éƒ¨æ³¨å…¥åˆ›å»ºçš„ <code>pinia</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia, PiniaVuePlugin &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line">Vue.use(PiniaVuePlugin)</span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  <span class="comment">// å…¶ä»–é…ç½®...</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// è¯·æ³¨æ„ï¼ŒåŒä¸€ä¸ª`pinia'å®ä¾‹</span></span><br><span class="line">  <span class="comment">// å¯ä»¥åœ¨åŒä¸€ä¸ªé¡µé¢çš„å¤šä¸ª Vue åº”ç”¨ä¸­ä½¿ç”¨ã€‚</span></span><br><span class="line">  pinia,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ‰èƒ½æä¾› devtools çš„æ”¯æŒã€‚åœ¨ Vue 3 ä¸­ï¼Œä¸€äº›åŠŸèƒ½ä»ç„¶ä¸è¢«æ”¯æŒï¼Œå¦‚ time traveling å’Œç¼–è¾‘ï¼Œè¿™æ˜¯å› ä¸º vue-devtools è¿˜æ²¡æœ‰ç›¸å…³çš„ APIï¼Œä½† devtools ä¹Ÿæœ‰å¾ˆå¤šé’ˆå¯¹ Vue 3 çš„ä¸“å±åŠŸèƒ½ï¼Œè€Œä¸”å°±å¼€å‘è€…çš„ä½“éªŒæ¥è¯´ï¼ŒVue 3 æ•´ä½“ä¸Šè¦å¥½å¾—å¤šã€‚åœ¨ Vue 2 ä¸­ï¼ŒPinia ä½¿ç”¨çš„æ˜¯ Vuex çš„ç°æœ‰æ¥å£ (å› æ­¤ä¸èƒ½ä¸ Vuex ä¸€èµ·ä½¿ç”¨) ã€‚</p>
<h3 id="åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-Store"><a href="#åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-Store" class="headerlink" title="åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Store?"></a><strong>åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Store?</strong></h3><p>ä¸€ä¸ª Store åº”è¯¥åŒ…å«å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ä¸­è®¿é—®çš„æ•°æ®ã€‚è¿™åŒ…æ‹¬åœ¨è®¸å¤šåœ°æ–¹ä½¿ç”¨çš„æ•°æ®ï¼Œä¾‹å¦‚æ˜¾ç¤ºåœ¨å¯¼èˆªæ ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠéœ€è¦é€šè¿‡é¡µé¢ä¿å­˜çš„æ•°æ®ï¼Œä¾‹å¦‚ä¸€ä¸ªéå¸¸å¤æ‚çš„å¤šæ­¥éª¤è¡¨å•ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œä½ åº”è¯¥é¿å…åœ¨ Store ä¸­å¼•å…¥é‚£äº›åŸæœ¬å¯ä»¥åœ¨ç»„ä»¶ä¸­ä¿å­˜çš„æœ¬åœ°æ•°æ®ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå…ƒç´ åœ¨é¡µé¢ä¸­çš„å¯è§æ€§ã€‚</p>
<p>å¹¶éæ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦è®¿é—®å…¨å±€çŠ¶æ€ï¼Œä½†å¦‚æœä½ çš„åº”ç”¨ç¡®å®éœ€è¦ä¸€ä¸ªå…¨å±€çŠ¶æ€ï¼Œé‚£ Pinia å°†ä½¿ä½ çš„å¼€å‘è¿‡ç¨‹æ›´è½»æ¾ã€‚</p>
<h3 id="ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Store"><a href="#ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Store" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ Store?"></a><strong>ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ Store?</strong></h3><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šè¿‡åº¦ä½¿ç”¨ storeã€‚å¦‚æœè§‰å¾—åº”ç”¨ç¨‹åºçš„ store è¿‡å¤šï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘ä½¿ç”¨ store çš„ç›®çš„ã€‚ä¾‹å¦‚å…¶ä¸­ä¸€äº›é€»è¾‘åº”è¯¥åªæ˜¯ç»„åˆå¼å‡½æ•°ï¼Œæˆ–è€…åº”è¯¥åªæ˜¯ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
<hr>
<h2 id="å®šä¹‰-Store"><a href="#å®šä¹‰-Store" class="headerlink" title="å®šä¹‰ Store"></a>å®šä¹‰ Store</h2><p>Store æ˜¯ç”¨ <code>defineStore()</code> å®šä¹‰çš„ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚æ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„åå­—ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  `defineStore()` çš„è¿”å›å€¼çš„å‘½åæ˜¯è‡ªç”±çš„</span></span><br><span class="line"><span class="comment">// ä½†æœ€å¥½å«æœ‰ store çš„åå­—ï¼Œä¸”ä»¥ `use` å¼€å¤´ï¼Œä»¥ `Store` ç»“å°¾ã€‚</span></span><br><span class="line"><span class="comment">// (æ¯”å¦‚ `useUserStore`ï¼Œ`useCartStore`ï¼Œ`useProductStore`)</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½ çš„åº”ç”¨ä¸­ Store çš„å”¯ä¸€ IDã€‚</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useAlertsStore = defineStore(<span class="string">'alerts'</span>, &#123;</span><br><span class="line">  <span class="comment">// å…¶ä»–é…ç½®...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªåå­— ï¼Œä¹Ÿè¢«ç”¨ä½œ id ï¼Œæ˜¯å¿…é¡»ä¼ å…¥çš„ï¼Œ Pinia å°†ç”¨å®ƒæ¥è¿æ¥ store å’Œ devtoolsã€‚ä¸ºäº†å…»æˆä¹ æƒ¯æ€§çš„ç”¨æ³•ï¼Œå°†è¿”å›çš„å‡½æ•°å‘½åä¸º useâ€¦ æ˜¯ä¸€ä¸ªç¬¦åˆç»„åˆå¼å‡½æ•°é£æ ¼çš„çº¦å®šã€‚</p>
<p><code>defineStore()</code> çš„ç¬¬äºŒä¸ªå‚æ•°å¯æ¥å—ä¸¤ç±»å€¼ï¼š<code>Setup å‡½æ•°</code>æˆ– <code>Option å¯¹è±¡</code>ã€‚</p>
<h3 id="Option-Store"><a href="#Option-Store" class="headerlink" title="Option Store"></a>Option Store</h3><p>ä¸ Vue çš„é€‰é¡¹å¼ API ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰ <code>state</code>ã€<code>actions</code> ä¸ <code>getters</code> å±æ€§çš„ Option å¯¹è±¡</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; count: <span class="number">0</span>, name: <span class="string">'Eduardo'</span> &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount: <span class="function">(<span class="params">state</span>) =&gt;</span> state.count * <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment() &#123;</span><br><span class="line">      <span class="keyword">this</span>.count++</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥è®¤ä¸º <code>state</code> æ˜¯ store çš„æ•°æ® (<code>data</code>)<code>ï¼Œgetters</code> æ˜¯ store çš„è®¡ç®—å±æ€§ (<code>computed</code>)ï¼Œè€Œ <code>actions</code> åˆ™æ˜¯æ–¹æ³• (<code>methods</code>)ã€‚</p>
<p>ä¸ºæ–¹ä¾¿ä¸Šæ‰‹ä½¿ç”¨ï¼ŒOption Store åº”å°½å¯èƒ½ç›´è§‚ç®€å•ã€‚</p>
<h3 id="Setup-Store"><a href="#Setup-Store" class="headerlink" title="Setup Store"></a>Setup Store</h3><p>ä¹Ÿå­˜åœ¨å¦ä¸€ç§å®šä¹‰ store çš„å¯ç”¨è¯­æ³•ã€‚ä¸ Vue ç»„åˆå¼ API çš„ setup å‡½æ•° ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å®šä¹‰äº†ä¸€äº›å“åº”å¼å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¸¦æœ‰æˆ‘ä»¬æƒ³æš´éœ²å‡ºå»çš„å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> name = ref(<span class="string">'Eduardo'</span>)</span><br><span class="line">  <span class="keyword">const</span> doubleCount = computed(<span class="function"><span class="params">()</span> =&gt;</span> count.value * <span class="number">2</span>)</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    count.value++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; count, name, doubleCount, increment &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨ <strong><em>Setup Store</em></strong> ä¸­ï¼š</p>
<ul>
<li><code>ref()</code> å°±æ˜¯ <code>state</code> å±æ€§</li>
<li><code>computed()</code> å°±æ˜¯ <code>getters</code> å±æ€§</li>
<li><code>function()</code> å°±æ˜¯ <code>actions</code> å±æ€§</li>
</ul>
<p>æ³¨æ„ï¼Œè¦è®© pinia æ­£ç¡®è¯†åˆ« <code>state</code>ï¼Œä½ å¿…é¡»åœ¨ setup store ä¸­è¿”å› <code>state</code> çš„æ‰€æœ‰å±æ€§ã€‚è¿™æ„å‘³ç€ï¼Œä½ ä¸èƒ½åœ¨ store ä¸­ä½¿ç”¨ç§æœ‰å±æ€§ã€‚ä¸å®Œæ•´è¿”å›ä¼šå½±å“ <code>SSR</code> ï¼Œå¼€å‘å·¥å…·å’Œå…¶ä»–æ’ä»¶çš„æ­£å¸¸è¿è¡Œã€‚</p>
<p><code>Setup store</code> æ¯” <code>Option Store</code> å¸¦æ¥äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨ä¸€ä¸ª <code>store</code> å†…åˆ›å»ºä¾¦å¬å™¨ï¼Œå¹¶è‡ªç”±åœ°ä½¿ç”¨ä»»ä½•ç»„åˆå¼å‡½æ•°ã€‚ä¸è¿‡ï¼Œè¯·è®°ä½ï¼Œä½¿ç”¨ç»„åˆå¼å‡½æ•°ä¼šè®© <code>SSR</code> å˜å¾—æ›´åŠ å¤æ‚ã€‚</p>
<p>Setup store ä¹Ÿå¯ä»¥ä¾èµ–äºå…¨å±€æä¾›çš„å±æ€§ï¼Œæ¯”å¦‚è·¯ç”±ã€‚ä»»ä½•<strong>åº”ç”¨å±‚é¢</strong>æä¾›çš„å±æ€§éƒ½å¯ä»¥åœ¨ store ä¸­ä½¿ç”¨ <code>inject()</code> è®¿é—®ï¼Œå°±åƒåœ¨ç»„ä»¶ä¸­ä¸€æ ·ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useSearchFilters = defineStore(<span class="string">'search-filters'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> route = useRoute()</span><br><span class="line">  <span class="comment">// è¿™é‡Œå‡å®š `app.provide('appProvided', 'value')` å·²ç»è°ƒç”¨è¿‡</span></span><br><span class="line">  <span class="keyword">const</span> appProvided = inject(<span class="string">'appProvided'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸è¦è¿”å›åƒ <code>route</code> æˆ– <code>appProvided</code> (ä¸Šä¾‹ä¸­)ä¹‹ç±»çš„å±æ€§ï¼Œå› ä¸ºå®ƒä»¬ä¸å±äº storeï¼Œè€Œä¸”ä½ å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥ç”¨ <code>useRoute()</code> å’Œ <code>inject(&#39;appProvided&#39;)</code> è®¿é—®ã€‚</p>
</blockquote>
<h3 id="ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ"><a href="#ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ" class="headerlink" title="ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ"></a>ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ</h3><p>å’Œåœ¨ Vue ä¸­å¦‚ä½•é€‰æ‹©ç»„åˆå¼ API ä¸é€‰é¡¹å¼ API ä¸€æ ·ï¼Œé€‰æ‹©ä½ è§‰å¾—æœ€èˆ’æœçš„é‚£ä¸€ä¸ªå°±å¥½ã€‚ä¸¤ç§è¯­æ³•éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚Option Store æ›´å®¹æ˜“ä½¿ç”¨ï¼Œè€Œ Setup Store æ›´çµæ´»å’Œå¼ºå¤§ã€‚</p>
<h3 id="ä½¿ç”¨-Store"><a href="#ä½¿ç”¨-Store" class="headerlink" title="ä½¿ç”¨ Store"></a>ä½¿ç”¨ Store</h3><p>è™½ç„¶æˆ‘ä»¬å‰é¢å®šä¹‰äº†ä¸€ä¸ª storeï¼Œä½†åœ¨æˆ‘ä»¬ä½¿ç”¨ <code>&lt;script setup&gt;</code> è°ƒç”¨ <code>useStore()</code>(æˆ–è€…ä½¿ç”¨ <code>setup()</code> å‡½æ•°ï¼Œåƒæ‰€æœ‰çš„ç»„ä»¶é‚£æ ·) ä¹‹å‰ï¼Œstore å®ä¾‹æ˜¯ä¸ä¼šè¢«åˆ›å»ºçš„ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">'@/stores/counter'</span></span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶å†…éƒ¨çš„ä»»ä½•åœ°æ–¹å‡å¯ä»¥è®¿é—®å˜é‡ `store` âœ¨</span></span><br><span class="line"><span class="keyword">const</span> store = useCounterStore()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œ<code>store</code> æ˜¯ä¸€ä¸ªç”¨ <code>reactive</code> åŒ…è£…çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦åœ¨ <code>getters</code> åé¢å†™ <code>.value</code>ã€‚å°±åƒ <code>setup</code> ä¸­çš„ <code>props</code> ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹å®ƒè¿›è¡Œè§£æ„ï¼š<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">'@/stores/counter'</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = useCounterStore()</span><br><span class="line"><span class="comment">// âŒ ä¸‹é¢è¿™éƒ¨åˆ†ä»£ç ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºå®ƒçš„å“åº”å¼è¢«ç ´åäº†</span></span><br><span class="line"><span class="comment">// ä¸ reactive ç›¸åŒ: https://vuejs.org/guide/essentials/reactivity-fundamentals.html#limitations-of-reactive</span></span><br><span class="line"><span class="keyword">const</span> &#123; name, doubleCount &#125; = store</span><br><span class="line">name <span class="comment">// å°†ä¼šä¸€ç›´æ˜¯ "Eduardo" //</span></span><br><span class="line">doubleCount <span class="comment">// å°†ä¼šä¸€ç›´æ˜¯ 0 //</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  store.increment()</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"><span class="comment">// âœ… è€Œè¿™ä¸€éƒ¨åˆ†ä»£ç å°±ä¼šç»´æŒå“åº”å¼</span></span><br><span class="line"><span class="comment">// ğŸ’¡ åœ¨è¿™é‡Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `store.doubleCount`</span></span><br><span class="line"><span class="keyword">const</span> doubleValue = computed(<span class="function"><span class="params">()</span> =&gt;</span> store.doubleCount)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="ä»-Store-è§£æ„-storeToRefs"><a href="#ä»-Store-è§£æ„-storeToRefs" class="headerlink" title="ä» Store è§£æ„ - storeToRefs()"></a>ä» Store è§£æ„ - storeToRefs()</h3><p>ä¸ºäº†ä» store ä¸­æå–å±æ€§æ—¶ä¿æŒå…¶å“åº”æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>storeToRefs()</code>ã€‚å®ƒå°†ä¸ºæ¯ä¸€ä¸ªå“åº”å¼å±æ€§åˆ›å»ºå¼•ç”¨ã€‚å½“ä½ åªä½¿ç”¨ store çš„çŠ¶æ€è€Œä¸è°ƒç”¨ä»»ä½• action æ—¶ï¼Œå®ƒä¼šéå¸¸æœ‰ç”¨ã€‚è¯·æ³¨æ„ï¼Œä½ å¯ä»¥ç›´æ¥ä» store ä¸­è§£æ„ actionï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿè¢«ç»‘å®šåˆ° store ä¸Šï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="keyword">const</span> store = useCounterStore()</span><br><span class="line"><span class="comment">// `name` å’Œ `doubleCount` éƒ½æ˜¯å“åº”å¼å¼•ç”¨</span></span><br><span class="line"><span class="comment">// ä¸‹é¢çš„ä»£ç åŒæ ·ä¼šæå–é‚£äº›æ¥è‡ªæ’ä»¶çš„å±æ€§çš„å“åº”å¼å¼•ç”¨</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯ä¼šè·³è¿‡æ‰€æœ‰çš„ action æˆ–è€…éå“åº”å¼ï¼ˆé ref æˆ–è€… é reactiveï¼‰çš„å±æ€§</span></span><br><span class="line"><span class="keyword">const</span> &#123; name, doubleCount &#125; = storeToRefs(store)</span><br><span class="line"><span class="comment">// åä¸º increment çš„ action å¯ä»¥è¢«è§£æ„</span></span><br><span class="line"><span class="keyword">const</span> &#123; increment &#125; = store</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>åœ¨ Pinia ä¸­ï¼Œstate è¢«å®šä¹‰ä¸ºä¸€ä¸ªè¿”å›åˆå§‹çŠ¶æ€çš„å‡½æ•°ã€‚è¿™ä½¿å¾— Pinia å¯ä»¥åŒæ—¶æ”¯æŒ<code>æœåŠ¡ç«¯</code>å’Œ<code>å®¢æˆ·ç«¯</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useStore = defineStore(<span class="string">'storeId'</span>, &#123;</span><br><span class="line">  <span class="comment">// ä¸ºäº†å®Œæ•´ç±»å‹æ¨ç†ï¼Œæ¨èä½¿ç”¨ç®­å¤´å‡½æ•°</span></span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰€æœ‰è¿™äº›å±æ€§éƒ½å°†è‡ªåŠ¨æ¨æ–­å‡ºå®ƒä»¬çš„ç±»å‹</span></span><br><span class="line">      count: <span class="number">0</span>,</span><br><span class="line">      name: <span class="string">'Eduardo'</span>,</span><br><span class="line">      isAdmin: <span class="literal">true</span>,</span><br><span class="line">      items: [],</span><br><span class="line">      hasChanged: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h3><p>ä½ å¹¶ä¸éœ€è¦åšå¤ªå¤šåŠªåŠ›å°±èƒ½ä½¿ä½ çš„ state å…¼å®¹ TSã€‚ç¡®ä¿å¯ç”¨äº† strictï¼Œæˆ–è€…è‡³å°‘å¯ç”¨äº† noImplicitThisï¼ŒPinia å°†è‡ªåŠ¨æ¨æ–­æ‚¨çš„çŠ¶æ€ç±»å‹ï¼ ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥å¸®åŠ©å®ƒè¿›è¡Œä¸€äº›è½¬æ¢ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useStore = defineStore(<span class="string">'storeId'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// ç”¨äºåˆå§‹åŒ–ç©ºåˆ—è¡¨</span></span><br><span class="line">      userList: [] <span class="keyword">as</span> UserInfo[],</span><br><span class="line">      <span class="comment">// ç”¨äºå°šæœªåŠ è½½çš„æ•°æ®</span></span><br><span class="line">      user: <span class="literal">null</span> <span class="keyword">as</span> UserInfo | <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> UserInfo &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªæ¥å£å®šä¹‰ stateï¼Œå¹¶æ·»åŠ  state() çš„è¿”å›å€¼çš„ç±»å‹ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> State &#123;</span><br><span class="line">  userList: UserInfo[]</span><br><span class="line">  user: UserInfo | <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useStore = defineStore(<span class="string">'storeId'</span>, &#123;</span><br><span class="line">  state: (): <span class="function"><span class="params">State</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      userList: [],</span><br><span class="line">      user: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> UserInfo &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è®¿é—®-state"><a href="#è®¿é—®-state" class="headerlink" title="è®¿é—® state"></a>è®¿é—® state</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ <code>store</code> å®ä¾‹è®¿é—® stateï¼Œç›´æ¥å¯¹å…¶è¿›è¡Œè¯»å†™ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = useStore()</span><br><span class="line"></span><br><span class="line">store.count++</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼Œæ–°çš„å±æ€§å¦‚æœæ²¡æœ‰åœ¨ <code>state()</code> ä¸­è¢«å®šä¹‰ï¼Œåˆ™ä¸èƒ½è¢«æ·»åŠ ã€‚å®ƒ<code>å¿…é¡»</code>åŒ…å«åˆå§‹çŠ¶æ€ã€‚</p>
</blockquote>
<h3 id="é‡ç½®state"><a href="#é‡ç½®state" class="headerlink" title="é‡ç½®state"></a>é‡ç½®state</h3><ul>
<li>ä½¿ç”¨ <strong><em>é€‰é¡¹å¼ API</em></strong> æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ store çš„ <code>$reset()</code> æ–¹æ³•å°† state é‡ç½®ä¸ºåˆå§‹å€¼ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = useStore()</span><br><span class="line"></span><br><span class="line">store.$reset()</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>$reset()</code> å†…éƒ¨ï¼Œä¼šè°ƒç”¨ <code>state()</code> å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡ï¼Œå¹¶ç”¨å®ƒæ›¿æ¢å½“å‰çŠ¶æ€ã€‚</p>
<hr>
<ul>
<li>åœ¨ <strong><em>Setup Stores</em></strong> ä¸­ï¼Œæ‚¨éœ€è¦<code>åˆ›å»ºè‡ªå·±çš„</code> $reset() æ–¹æ³•ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">$reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    count.value = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; count, $reset &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•"><a href="#ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•" class="headerlink" title="ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•"></a>ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•</h3><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥å‡è®¾ç›¸å…³ store å·²ç»åˆ›å»ºäº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹æ–‡ä»¶è·¯å¾„ï¼š</span></span><br><span class="line"><span class="comment">// ./src/stores/counter.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä¸èƒ½ä½¿ç”¨ç»„åˆå¼ APIï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ computedï¼Œmethodsï¼Œâ€¦ï¼Œé‚£ä½ å¯ä»¥ä½¿ç”¨ <code>mapState()</code> è¾…åŠ©å‡½æ•°å°† state å±æ€§æ˜ å°„ä¸ºåªè¯»çš„è®¡ç®—å±æ€§ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">'../stores/counter'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥è®¿é—®ç»„ä»¶ä¸­çš„ this.count</span></span><br><span class="line">    <span class="comment">// ä¸ä» store.count ä¸­è¯»å–çš„æ•°æ®ç›¸åŒ</span></span><br><span class="line">    ...mapState(useCounterStore, [<span class="string">'count'</span>])</span><br><span class="line">    <span class="comment">// ä¸ä¸Šè¿°ç›¸åŒï¼Œä½†å°†å…¶æ³¨å†Œä¸º this.myOwnName</span></span><br><span class="line">    ...mapState(useCounterStore, &#123;</span><br><span class="line">      myOwnName: <span class="string">'count'</span>,</span><br><span class="line">      <span class="comment">// ä½ ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥è·å¾—å¯¹ store çš„è®¿é—®æƒ</span></span><br><span class="line">      double: <span class="function"><span class="params">store</span> =&gt;</span> store.count * <span class="number">2</span>,</span><br><span class="line">      <span class="comment">// å®ƒå¯ä»¥è®¿é—® `this`ï¼Œä½†å®ƒæ²¡æœ‰æ ‡æ³¨ç±»å‹...</span></span><br><span class="line">      magicValue(store) &#123;</span><br><span class="line">        <span class="keyword">return</span> store.someGetter + <span class="keyword">this</span>.count + <span class="keyword">this</span>.double</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¯ä¿®æ”¹çš„-state"><a href="#å¯ä¿®æ”¹çš„-state" class="headerlink" title="å¯ä¿®æ”¹çš„ state"></a>å¯ä¿®æ”¹çš„ state</h4><p>å¦‚æœä½ æƒ³ä¿®æ”¹è¿™äº› state å±æ€§ (ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªè¡¨å•)ï¼Œä½ å¯ä»¥ä½¿ç”¨ mapWritableState() ä½œä¸ºä»£æ›¿ã€‚ä½†æ³¨æ„ä½ ä¸èƒ½åƒ mapState() é‚£æ ·ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapWritableState &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">'../stores/counter'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥è®¿é—®ç»„ä»¶ä¸­çš„ this.countï¼Œå¹¶å…è®¸è®¾ç½®å®ƒã€‚</span></span><br><span class="line">    <span class="comment">// this.count++</span></span><br><span class="line">    <span class="comment">// ä¸ä» store.count ä¸­è¯»å–çš„æ•°æ®ç›¸åŒ</span></span><br><span class="line">    ...mapWritableState(useCounterStore, [<span class="string">'count'</span>])</span><br><span class="line">    <span class="comment">// ä¸ä¸Šè¿°ç›¸åŒï¼Œä½†å°†å…¶æ³¨å†Œä¸º this.myOwnName</span></span><br><span class="line">    ...mapWritableState(useCounterStore, &#123;</span><br><span class="line">      myOwnName: <span class="string">'count'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å˜æ›´-state-patch"><a href="#å˜æ›´-state-patch" class="headerlink" title="å˜æ›´ state - $patch"></a>å˜æ›´ state - $patch</h3><p>é™¤äº†ç”¨ <code>store.count++</code> ç›´æ¥æ”¹å˜ storeï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨ <code>$patch</code> æ–¹æ³•ã€‚å®ƒå…è®¸ä½ ç”¨ä¸€ä¸ª <code>state</code> çš„è¡¥ä¸å¯¹è±¡åœ¨åŒä¸€æ—¶é—´æ›´æ”¹å¤šä¸ªå±æ€§ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">store.$patch(&#123;</span><br><span class="line">  count: store.count + <span class="number">1</span>,</span><br><span class="line">  age: <span class="number">120</span>,</span><br><span class="line">  name: <span class="string">'DIO'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼Œç”¨è¿™ç§è¯­æ³•çš„è¯ï¼Œæœ‰äº›å˜æ›´çœŸçš„å¾ˆéš¾å®ç°æˆ–è€…å¾ˆè€—æ—¶ï¼šä»»ä½•é›†åˆçš„ä¿®æ”¹ï¼ˆä¾‹å¦‚ï¼Œå‘æ•°ç»„ä¸­æ·»åŠ ã€ç§»é™¤ä¸€ä¸ªå…ƒç´ æˆ–æ˜¯åš <code>splice</code> æ“ä½œï¼‰éƒ½éœ€è¦ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆã€‚å› æ­¤ï¼Œ<code>$patch</code> æ–¹æ³•ä¹Ÿæ¥å—ä¸€ä¸ªå‡½æ•°æ¥ç»„åˆè¿™ç§éš¾ä»¥ç”¨è¡¥ä¸å¯¹è±¡å®ç°çš„å˜æ›´ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">store.$patch(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  state.items.push(&#123; <span class="attr">name</span>: <span class="string">'shoes'</span>, <span class="attr">quantity</span>: <span class="number">1</span> &#125;)</span><br><span class="line">  state.hasChanged = <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸¤ç§å˜æ›´ store æ–¹æ³•çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œ$patch() å…è®¸ä½ å°†å¤šä¸ªå˜æ›´å½’å…¥ devtools çš„åŒä¸€ä¸ªæ¡ç›®ä¸­ã€‚åŒæ—¶è¯·æ³¨æ„ï¼Œç›´æ¥ä¿®æ”¹ stateï¼Œ$patch() ä¹Ÿä¼šå‡ºç°åœ¨ devtools ä¸­ï¼Œè€Œä¸”å¯ä»¥è¿›è¡Œ time travel (åœ¨ Vue 3 ä¸­è¿˜æ²¡æœ‰)ã€‚</p>
<h3 id="æ›¿æ¢-state"><a href="#æ›¿æ¢-state" class="headerlink" title="æ›¿æ¢ state"></a>æ›¿æ¢ state</h3><p>ä½ ä¸èƒ½å®Œå…¨æ›¿æ¢æ‰ store çš„ stateï¼Œå› ä¸ºé‚£æ ·ä¼šç ´åå…¶å“åº”æ€§ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ <strong><em>patch</em></strong> å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™å®é™…ä¸Šå¹¶æ²¡æœ‰æ›¿æ¢`$state`</span></span><br><span class="line">store.$state = &#123; <span class="attr">count</span>: <span class="number">24</span> &#125;</span><br><span class="line"><span class="comment">// åœ¨å®ƒå†…éƒ¨è°ƒç”¨ `$patch()`ï¼š</span></span><br><span class="line">store.$patch(&#123; <span class="attr">count</span>: <span class="number">24</span> &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="è®¢é˜…-state-subscribe"><a href="#è®¢é˜…-state-subscribe" class="headerlink" title="è®¢é˜… state - $subscribe()"></a>è®¢é˜… state - $subscribe()</h3><p>ç±»ä¼¼äº Vuex çš„ <code>subscribe</code> æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ store çš„ <code>$subscribe()</code> æ–¹æ³•ä¾¦å¬ state åŠå…¶å˜åŒ–ã€‚æ¯”èµ·æ™®é€šçš„ <code>watch()</code>ï¼Œä½¿ç”¨ <code>$subscribe()</code> çš„å¥½å¤„æ˜¯ <strong><em>subscriptions</em></strong> åœ¨ <strong><em>patch</em></strong> ååªè§¦å‘ä¸€æ¬¡ (ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ä¸Šé¢çš„å‡½æ•°ç‰ˆæœ¬æ—¶)ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cartStore.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// import &#123; MutationType &#125; from 'pinia'</span></span><br><span class="line">  mutation.type <span class="comment">// 'direct' | 'patch object' | 'patch function'</span></span><br><span class="line">  <span class="comment">// å’Œ cartStore.$id ä¸€æ ·</span></span><br><span class="line">  mutation.storeId <span class="comment">// 'cart'</span></span><br><span class="line">  <span class="comment">// åªæœ‰ mutation.type === 'patch object'çš„æƒ…å†µä¸‹æ‰å¯ç”¨</span></span><br><span class="line">  mutation.payload <span class="comment">// ä¼ é€’ç»™ cartStore.$patch() çš„è¡¥ä¸å¯¹è±¡ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†æ•´ä¸ª state æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨ã€‚</span></span><br><span class="line">  localStorage.setItem(<span class="string">'cart'</span>, <span class="built_in">JSON</span>.stringify(state))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="åˆ·æ–°æ—¶æœº"><a href="#åˆ·æ–°æ—¶æœº" class="headerlink" title="åˆ·æ–°æ—¶æœº"></a>åˆ·æ–°æ—¶æœº</h3><p>åœ¨åº•å±‚å®ç°ä¸Šï¼Œ<code>$subscribe()</code> ä½¿ç”¨äº† Vue çš„ <code>watch()</code> å‡½æ•°ã€‚ä½ å¯ä»¥ä¼ å…¥ä¸ <code>watch()</code> ç›¸åŒçš„é€‰é¡¹ã€‚å½“ä½ æƒ³è¦åœ¨ æ¯æ¬¡ state å˜åŒ–åç«‹å³è§¦å‘è®¢é˜…æ—¶å¾ˆæœ‰ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cartStore.$subscribe(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†æ•´ä¸ª state æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨</span></span><br><span class="line">  localStorage.setItem(<span class="string">'cart'</span>, <span class="built_in">JSON</span>.stringify(state))</span><br><span class="line">&#125;, &#123; <span class="attr">flush</span>: <span class="string">'sync'</span> &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="å–æ¶ˆè®¢é˜…"><a href="#å–æ¶ˆè®¢é˜…" class="headerlink" title="å–æ¶ˆè®¢é˜…"></a>å–æ¶ˆè®¢é˜…</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong><em>state subscription</em></strong> ä¼šè¢«ç»‘å®šåˆ°æ·»åŠ å®ƒä»¬çš„ç»„ä»¶ä¸Š (å¦‚æœ store åœ¨ç»„ä»¶çš„ <code>setup()</code> é‡Œé¢)ã€‚è¿™æ„å‘³ç€ï¼Œå½“è¯¥ç»„ä»¶è¢«å¸è½½æ—¶ï¼Œå®ƒä»¬å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚å¦‚æœä½ æƒ³åœ¨ç»„ä»¶å¸è½½åä¾æ—§ä¿ç•™å®ƒä»¬ï¼Œè¯·å°† <code>{ detached: true }</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥å°† <strong><em>state subscription</em></strong> ä»å½“å‰ç»„ä»¶ä¸­åˆ†ç¦»ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> someStore = useSomeStore()</span><br><span class="line"><span class="comment">// æ­¤è®¢é˜…å™¨å³ä¾¿åœ¨ç»„ä»¶å¸è½½ä¹‹åä»ä¼šè¢«ä¿ç•™</span></span><br><span class="line">someStore.$subscribe(callback, &#123; <span class="attr">detached</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½ å¯ä»¥åœ¨ <code>pinia</code> å®ä¾‹ä¸Šä½¿ç”¨ <code>watch()</code> å‡½æ•°ä¾¦å¬æ•´ä¸ª stateã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">watch(</span><br><span class="line">  pinia.state,</span><br><span class="line">  (state) =&gt; &#123;</span><br><span class="line">    <span class="comment">// æ¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†æ•´ä¸ª state æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨ã€‚</span></span><br><span class="line">    localStorage.setItem(<span class="string">'piniaState'</span>, <span class="built_in">JSON</span>.stringify(state))</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h2 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h2><p>Getter å®Œå…¨ç­‰åŒäº store çš„ state çš„è®¡ç®—å€¼ã€‚å¯ä»¥é€šè¿‡ defineStore() ä¸­çš„ <code>getters</code> å±æ€§æ¥å®šä¹‰å®ƒä»¬ã€‚æ¨èä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¹¶ä¸”å®ƒå°†æ¥æ”¶ <code>state</code> ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount: <span class="function">(<span class="params">state</span>) =&gt;</span> state.count * <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œgetter ä»…ä¾èµ– stateã€‚ä¸è¿‡ï¼Œæœ‰æ—¶å®ƒä»¬ä¹Ÿå¯èƒ½ä¼šä½¿ç”¨å…¶ä»– getterã€‚å› æ­¤ï¼Œå³ä½¿åœ¨ä½¿ç”¨å¸¸è§„å‡½æ•°å®šä¹‰ getter æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>this</code> è®¿é—®åˆ°æ•´ä¸ª store å®ä¾‹ï¼Œä½†(åœ¨ TypeScript ä¸­)å¿…é¡»å®šä¹‰è¿”å›ç±»å‹ã€‚è¿™æ˜¯ä¸ºäº†é¿å… TypeScript çš„å·²çŸ¥ç¼ºé™·ï¼Œä¸è¿‡è¿™ä¸å½±å“ç”¨ç®­å¤´å‡½æ•°å®šä¹‰çš„ getterï¼Œä¹Ÿä¸ä¼šå½±å“ä¸ä½¿ç”¨ <code>this</code> çš„ getterã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨æ¨æ–­å‡ºè¿”å›ç±»å‹æ˜¯ä¸€ä¸ª number</span></span><br><span class="line">    doubleCount(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count * <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è¿”å›ç±»å‹**å¿…é¡»**æ˜ç¡®è®¾ç½®</span></span><br><span class="line">    doublePlusOne(): number &#123;</span><br><span class="line">      <span class="comment">// æ•´ä¸ª store çš„ è‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ ‡æ³¨ âœ¨</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.doubleCount + <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½ å¯ä»¥ç›´æ¥è®¿é—® store å®ä¾‹ä¸Šçš„ getter äº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">'./counterStore'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = useCounterStore()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;template&gt;</span></span><br><span class="line"><span class="regexp">  &lt;p&gt;Double count is &#123;&#123; store.doubleCount &#125;&#125;&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="è®¿é—®å…¶ä»–-getter"><a href="#è®¿é—®å…¶ä»–-getter" class="headerlink" title="è®¿é—®å…¶ä»– getter"></a>è®¿é—®å…¶ä»– getter</h3><p>ä¸è®¡ç®—å±æ€§ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥ç»„åˆå¤šä¸ª getterã€‚é€šè¿‡ <code>this</code>ï¼Œä½ å¯ä»¥è®¿é—®åˆ°å…¶ä»–ä»»ä½• getterã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä¸ºè¿™ä¸ª getter æŒ‡å®šä¸€ä¸ªè¿”å›å€¼çš„ç±»å‹ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterStore.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count * <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    doubleCountPlusOne(): <span class="built_in">number</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.doubleCount + <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterStore.js</span></span><br><span class="line"><span class="comment">// ä½ å¯ä»¥åœ¨ JavaScript ä¸­ä½¿ç”¨ JSDoc (https://jsdoc.app/tags-returns.html)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="comment">// ç±»å‹æ˜¯è‡ªåŠ¨æ¨æ–­å‡ºæ¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ `this`</span></span><br><span class="line">    doubleCount: <span class="function">(<span class="params">state</span>) =&gt;</span> state.count * <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ·»åŠ ç±»å‹(åœ¨ JS ä¸­ä½¿ç”¨ JSDoc)</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ç”¨ this æ¥å¼•ç”¨ getter</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å› count çš„å€¼ä¹˜ä»¥ 2 åŠ  1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    doubleCountPlusOne() &#123;</span><br><span class="line">      <span class="comment">// è‡ªåŠ¨è¡¥å…¨ âœ¨</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.doubleCount + <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="å‘-getter-ä¼ é€’å‚æ•°"><a href="#å‘-getter-ä¼ é€’å‚æ•°" class="headerlink" title="å‘ getter ä¼ é€’å‚æ•°"></a>å‘ getter ä¼ é€’å‚æ•°</h3><p><strong><em>Getter</em></strong> åªæ˜¯å¹•åçš„è®¡ç®—å±æ€§ï¼Œæ‰€ä»¥ä¸å¯ä»¥å‘å®ƒä»¬ä¼ é€’ä»»ä½•å‚æ•°ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥ä» <strong><em>getter</em></strong> è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ¥å—ä»»æ„å‚æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserListStore = defineStore(<span class="string">'userList'</span>, &#123;</span><br><span class="line">  getters: &#123;</span><br><span class="line">    getUserById: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">userId</span>) =&gt;</span> state.users.find(<span class="function">(<span class="params">user</span>) =&gt;</span> user.id === userId)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useUserListStore &#125; <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"><span class="keyword">const</span> userList = useUserListStore()</span><br><span class="line"><span class="keyword">const</span> &#123; getUserById &#125; = storeToRefs(userList)</span><br><span class="line"><span class="comment">// è¯·æ³¨æ„ï¼Œä½ éœ€è¦ä½¿ç”¨ `getUserById.value` æ¥è®¿é—®</span></span><br><span class="line"><span class="comment">// &lt;script setup&gt; ä¸­çš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;User <span class="number">2</span>: &#123;&#123; getUserById(<span class="number">2</span>) &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œå½“ä½ è¿™æ ·åšæ—¶ï¼Œ<strong>getter å°†ä¸å†è¢«ç¼“å­˜</strong>ã€‚å®ƒä»¬åªæ˜¯ä¸€ä¸ªè¢«ä½ è°ƒç”¨çš„å‡½æ•°ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥åœ¨ getter æœ¬èº«ä¸­ç¼“å­˜ä¸€äº›ç»“æœï¼Œè™½ç„¶è¿™ç§åšæ³•å¹¶ä¸å¸¸è§ï¼Œä½†æœ‰è¯æ˜è¡¨æ˜å®ƒçš„æ€§èƒ½ä¼šæ›´å¥½ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserListStore = defineStore(<span class="string">'userList'</span>, &#123;</span><br><span class="line">  getters: &#123;</span><br><span class="line">    getActiveUserById(state) &#123;</span><br><span class="line">      <span class="keyword">const</span> activeUsers = state.users.filter(<span class="function">(<span class="params">user</span>) =&gt;</span> user.active)</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">userId</span>) =&gt;</span> activeUsers.find(<span class="function">(<span class="params">user</span>) =&gt;</span> user.id === userId)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="è®¿é—®å…¶ä»–-store-çš„-getter"><a href="#è®¿é—®å…¶ä»–-store-çš„-getter" class="headerlink" title="è®¿é—®å…¶ä»– store çš„ getter"></a>è®¿é—®å…¶ä»– store çš„ getter</h3><p>æƒ³è¦ä½¿ç”¨å¦ä¸€ä¸ª store çš„ getter çš„è¯ï¼Œé‚£å°±ç›´æ¥åœ¨ getter å†…ä½¿ç”¨å°±å¥½ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useOtherStore &#125; <span class="keyword">from</span> <span class="string">'./other-store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useStore = defineStore(<span class="string">'main'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    otherGetter(state) &#123;</span><br><span class="line">      <span class="keyword">const</span> otherStore = useOtherStore()</span><br><span class="line">      <span class="keyword">return</span> state.localData + otherStore.data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-setup-æ—¶çš„ç”¨æ³•"><a href="#ä½¿ç”¨-setup-æ—¶çš„ç”¨æ³•" class="headerlink" title="ä½¿ç”¨ setup() æ—¶çš„ç”¨æ³•"></a>ä½¿ç”¨ setup() æ—¶çš„ç”¨æ³•</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> store = useCounterStore()</span><br><span class="line">store.count = <span class="number">3</span></span><br><span class="line">store.doubleCount <span class="comment">// 6</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•-1"><a href="#ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•-1" class="headerlink" title="ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•"></a>ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•</h3><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥å‡è®¾ç›¸å…³çš„ store å·²ç»åˆ›å»ºäº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹æ–‡ä»¶è·¯å¾„ï¼š</span></span><br><span class="line"><span class="comment">// ./src/stores/counter.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'counter'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count * <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p>Action ç›¸å½“äºç»„ä»¶ä¸­çš„ <code>method</code>ã€‚å®ƒä»¬å¯ä»¥é€šè¿‡ <code>defineStore()</code> ä¸­çš„ <code>actions</code> å±æ€§æ¥å®šä¹‰ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿæ˜¯å®šä¹‰ä¸šåŠ¡é€»è¾‘çš„å®Œç¾é€‰æ‹©ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'main'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment() &#123;</span><br><span class="line">      <span class="keyword">this</span>.count++</span><br><span class="line">    &#125;,</span><br><span class="line">    randomizeCounter() &#123;</span><br><span class="line">      <span class="keyword">this</span>.count = <span class="built_in">Math</span>.round(<span class="number">100</span> * <span class="built_in">Math</span>.random())</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼ <strong><em>getter</em></strong>ï¼Œaction ä¹Ÿå¯é€šè¿‡ <code>this</code> è®¿é—®æ•´ä¸ª store å®ä¾‹ï¼Œå¹¶æ”¯æŒå®Œæ•´çš„ç±»å‹æ ‡æ³¨(ä»¥åŠè‡ªåŠ¨è¡¥å…¨âœ¨)ã€‚ä¸åŒçš„æ˜¯ï¼Œ<code>action</code> å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œä½ å¯ä»¥åœ¨å®ƒä»¬é‡Œé¢ <code>await</code> è°ƒç”¨ä»»ä½• APIï¼Œä»¥åŠå…¶ä»– actionï¼<br>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Mande çš„ä¾‹å­ã€‚è¯·æ³¨æ„ï¼Œä½ ä½¿ç”¨ä»€ä¹ˆåº“å¹¶ä¸é‡è¦ï¼Œåªè¦ä½ å¾—åˆ°çš„æ˜¯ä¸€ä¸ªPromiseã€‚ä½ ç”šè‡³å¯ä»¥ (åœ¨æµè§ˆå™¨ä¸­) ä½¿ç”¨åŸç”Ÿ fetch å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mande &#125; <span class="keyword">from</span> <span class="string">'mande'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = mande(<span class="string">'/api/users'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsers = defineStore(<span class="string">'users'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    userData: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> registerUser(login, password) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.userData = <span class="keyword">await</span> api.post(&#123; login, password &#125;)</span><br><span class="line">        showTooltip(<span class="string">`Welcome back <span class="subst">$&#123;<span class="keyword">this</span>.userData.name&#125;</span>!`</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        showTooltip(error)</span><br><span class="line">        <span class="comment">// è®©è¡¨å•ç»„ä»¶æ˜¾ç¤ºé”™è¯¯</span></span><br><span class="line">        <span class="keyword">return</span> error</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå®Œå…¨å¯ä»¥è‡ªç”±åœ°è®¾ç½®ä»»ä½•ä½ æƒ³è¦çš„å‚æ•°ä»¥åŠè¿”å›ä»»ä½•ç»“æœã€‚å½“è°ƒç”¨ action æ—¶ï¼Œä¸€åˆ‡ç±»å‹ä¹Ÿéƒ½æ˜¯å¯ä»¥è¢«è‡ªåŠ¨æ¨æ–­å‡ºæ¥çš„ã€‚</p>
<p>Action å¯ä»¥åƒå‡½æ•°æˆ–è€…é€šå¸¸æ„ä¹‰ä¸Šçš„æ–¹æ³•ä¸€æ ·è¢«è°ƒç”¨ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> store = useCounterStore()</span><br><span class="line"><span class="comment">// å°† action ä½œä¸º store çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨</span></span><br><span class="line">store.randomizeCounter()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;template&gt;</span></span><br><span class="line"><span class="regexp">  &lt;!-- å³ä½¿åœ¨æ¨¡æ¿ä¸­ä¹Ÿå¯ä»¥ --&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button @click="store.randomizeCounter()"&gt;Randomize&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="è®¿é—®å…¶ä»–-store-çš„-action"><a href="#è®¿é—®å…¶ä»–-store-çš„-action" class="headerlink" title="è®¿é—®å…¶ä»– store çš„ action"></a>è®¿é—®å…¶ä»– store çš„ action</h3><p>æƒ³è¦ä½¿ç”¨å¦ä¸€ä¸ª store çš„è¯ï¼Œé‚£ä½ ç›´æ¥åœ¨ <strong><em>action</em></strong> ä¸­è°ƒç”¨å°±å¥½äº†ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useAuthStore &#125; <span class="keyword">from</span> <span class="string">'./auth-store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useSettingsStore = defineStore(<span class="string">'settings'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    preferences: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> fetchUserPreferences() &#123;</span><br><span class="line">      <span class="keyword">const</span> auth = useAuthStore()</span><br><span class="line">      <span class="keyword">if</span> (auth.isAuthenticated) &#123;</span><br><span class="line">        <span class="keyword">this</span>.preferences = <span class="keyword">await</span> fetchPreferences()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'User must be authenticated'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•-2"><a href="#ä½¿ç”¨é€‰é¡¹å¼-API-çš„ç”¨æ³•-2" class="headerlink" title="ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•"></a>ä½¿ç”¨é€‰é¡¹å¼ API çš„ç”¨æ³•</h3><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥å‡è®¾ç›¸å…³çš„ store å·²ç»åˆ›å»ºäº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹æ–‡ä»¶è·¯å¾„ï¼š</span></span><br><span class="line"><span class="comment">// ./src/stores/counter.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'main'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment() &#123;</span><br><span class="line">      <span class="keyword">this</span>.count++</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="è®¢é˜…-action"><a href="#è®¢é˜…-action" class="headerlink" title="è®¢é˜… action"></a>è®¢é˜… action</h3><p>ä½ å¯ä»¥é€šè¿‡ <code>store.$onAction()</code> æ¥ç›‘å¬ action å’Œå®ƒä»¬çš„ç»“æœã€‚ä¼ é€’ç»™å®ƒçš„å›è°ƒå‡½æ•°ä¼šåœ¨ action æœ¬èº«ä¹‹å‰æ‰§è¡Œã€‚<code>after</code> è¡¨ç¤ºåœ¨ promise è§£å†³ä¹‹åï¼Œå…è®¸ä½ åœ¨ action è§£å†³åæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚åŒæ ·åœ°ï¼Œ<code>onError</code> å…è®¸ä½ åœ¨ action æŠ›å‡ºé”™è¯¯æˆ– reject æ—¶æ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è¿™äº›å‡½æ•°å¯¹äºè¿½è¸ªè¿è¡Œæ—¶é”™è¯¯éå¸¸æœ‰ç”¨.</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è¿è¡Œ action ä¹‹å‰ä»¥åŠ action resolve/reject ä¹‹åæ‰“å°æ—¥å¿—è®°å½•ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unsubscribe = someStore.$onAction(</span><br><span class="line">  (&#123;</span><br><span class="line">    name, <span class="comment">// action åç§°</span></span><br><span class="line">    store, <span class="comment">// store å®ä¾‹ï¼Œç±»ä¼¼ `someStore`</span></span><br><span class="line">    args, <span class="comment">// ä¼ é€’ç»™ action çš„å‚æ•°æ•°ç»„</span></span><br><span class="line">    after, <span class="comment">// åœ¨ action è¿”å›æˆ–è§£å†³åçš„é’©å­</span></span><br><span class="line">    onError, <span class="comment">// action æŠ›å‡ºæˆ–æ‹’ç»çš„é’©å­</span></span><br><span class="line">  &#125;) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ä¸ºè¿™ä¸ªç‰¹å®šçš„ action è°ƒç”¨æä¾›ä¸€ä¸ªå…±äº«å˜é‡</span></span><br><span class="line">    <span class="keyword">const</span> startTime = <span class="built_in">Date</span>.now()</span><br><span class="line">    <span class="comment">// è¿™å°†åœ¨æ‰§è¡Œ "store "çš„ action ä¹‹å‰è§¦å‘ã€‚</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Start "<span class="subst">$&#123;name&#125;</span>" with params [<span class="subst">$&#123;args.join(<span class="string">', '</span>)&#125;</span>].`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™å°†åœ¨ action æˆåŠŸå¹¶å®Œå…¨è¿è¡Œåè§¦å‘ã€‚</span></span><br><span class="line">    <span class="comment">// å®ƒç­‰å¾…ç€ä»»ä½•è¿”å›çš„ promise</span></span><br><span class="line">    after(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(</span><br><span class="line">        <span class="string">`Finished "<span class="subst">$&#123;name&#125;</span>" after <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">          <span class="built_in">Date</span>.now() - startTime</span></span></span><br><span class="line"><span class="string"><span class="subst">        &#125;</span>ms.\nResult: <span class="subst">$&#123;result&#125;</span>.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ action æŠ›å‡ºæˆ–è¿”å›ä¸€ä¸ªæ‹’ç»çš„ promiseï¼Œè¿™å°†è§¦å‘</span></span><br><span class="line">    onError(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(</span><br><span class="line">        <span class="string">`Failed "<span class="subst">$&#123;name&#125;</span>" after <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms.\nError: <span class="subst">$&#123;error&#125;</span>.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰‹åŠ¨åˆ é™¤ç›‘å¬å™¨</span></span><br><span class="line">unsubscribe()</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong><em>action</em></strong> è®¢é˜…å™¨ä¼šè¢«ç»‘å®šåˆ°æ·»åŠ å®ƒä»¬çš„ç»„ä»¶ä¸Š(å¦‚æœ store åœ¨ç»„ä»¶çš„ <code>setup()</code> å†…)ã€‚è¿™æ„å‘³ç€ï¼Œå½“è¯¥ç»„ä»¶è¢«å¸è½½æ—¶ï¼Œå®ƒä»¬å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚å¦‚æœä½ æƒ³åœ¨ç»„ä»¶å¸è½½åä¾æ—§ä¿ç•™å®ƒä»¬ï¼Œè¯·å°† <code>true</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ <strong><em>action</em></strong> è®¢é˜…å™¨ï¼Œä»¥ä¾¿å°†å…¶ä»å½“å‰ç»„ä»¶ä¸­åˆ†ç¦»ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> someStore = useSomeStore()</span><br><span class="line"><span class="comment">// æ­¤è®¢é˜…å™¨å³ä¾¿åœ¨ç»„ä»¶å¸è½½ä¹‹åä»ä¼šè¢«ä¿ç•™</span></span><br><span class="line">someStore.$onAction(callback, <span class="literal">true</span>)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><p>ç”±äºæœ‰äº†åº•å±‚ API çš„æ”¯æŒï¼ŒPinia store ç°åœ¨å®Œå…¨æ”¯æŒæ‰©å±•ã€‚ä»¥ä¸‹æ˜¯ä½ å¯ä»¥æ‰©å±•çš„å†…å®¹ï¼š</p>
<ul>
<li>ä¸º store æ·»åŠ æ–°çš„å±æ€§</li>
<li>å®šä¹‰ store æ—¶å¢åŠ æ–°çš„é€‰é¡¹</li>
<li>ä¸º store å¢åŠ æ–°çš„æ–¹æ³•</li>
<li>åŒ…è£…ç°æœ‰çš„æ–¹æ³•</li>
<li>æ”¹å˜ç”šè‡³å–æ¶ˆ action</li>
<li>å®ç°å‰¯ä½œç”¨ï¼Œå¦‚<strong>æœ¬åœ°å­˜å‚¨</strong></li>
<li>ä»…åº”ç”¨æ’ä»¶äºç‰¹å®š store</li>
</ul>
<p>æ’ä»¶æ˜¯é€šè¿‡ <code>pinia.use()</code> æ·»åŠ åˆ° pinia å®ä¾‹çš„ã€‚æœ€ç®€å•çš„ä¾‹å­æ˜¯é€šè¿‡è¿”å›ä¸€ä¸ªå¯¹è±¡å°†ä¸€ä¸ªé™æ€å±æ€§æ·»åŠ åˆ°æ‰€æœ‰ storeã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºçš„æ¯ä¸ª store ä¸­éƒ½ä¼šæ·»åŠ ä¸€ä¸ªåä¸º `secret` çš„å±æ€§ã€‚</span></span><br><span class="line"><span class="comment">// åœ¨å®‰è£…æ­¤æ’ä»¶åï¼Œæ’ä»¶å¯ä»¥ä¿å­˜åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SecretPiniaPlugin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">secret</span>: <span class="string">'the cake is a lie'</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="comment">// å°†è¯¥æ’ä»¶äº¤ç»™ Pinia</span></span><br><span class="line">pinia.use(SecretPiniaPlugin)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">const</span> store = useStore()</span><br><span class="line">store.secret <span class="comment">// 'the cake is a lie'</span></span><br></pre></td></tr></table></figure>
<p>è¿™å¯¹æ·»åŠ å…¨å±€å¯¹è±¡å¾ˆæœ‰ç”¨ï¼Œå¦‚è·¯ç”±å™¨ã€modal æˆ– toast ç®¡ç†å™¨ã€‚</p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Pinia æ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°è¿”å›è¦æ·»åŠ åˆ° store çš„å±æ€§ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå³ contextã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">myPiniaPlugin</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  context.pinia <span class="comment">// ç”¨ `createPinia()` åˆ›å»ºçš„ piniaã€‚</span></span><br><span class="line">  context.app <span class="comment">// ç”¨ `createApp()` åˆ›å»ºçš„å½“å‰åº”ç”¨(ä»… Vue 3)ã€‚</span></span><br><span class="line">  context.store <span class="comment">// è¯¥æ’ä»¶æƒ³æ‰©å±•çš„ store</span></span><br><span class="line">  context.options <span class="comment">// å®šä¹‰ä¼ ç»™ `defineStore()` çš„ store çš„å¯é€‰å¯¹è±¡ã€‚</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç”¨ <code>pinia.use()</code> å°†è¿™ä¸ªå‡½æ•°ä¼ ç»™ <code>pinia</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pinia.use(myPiniaPlugin)</span><br></pre></td></tr></table></figure>
<h3 id="æ‰©å±•-store"><a href="#æ‰©å±•-store" class="headerlink" title="æ‰©å±• store"></a>æ‰©å±• store</h3><p>ä½ å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥å‘ store æ·»åŠ æ–°çš„å±æ€§ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pinia.use(<span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;))</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ store ä¸Šè®¾ç½®è¯¥å±æ€§ï¼Œä½†å¯ä»¥çš„è¯ï¼Œè¯·ä½¿ç”¨è¿”å›å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™æ ·å®ƒä»¬å°±èƒ½è¢« devtools è‡ªåŠ¨è¿½è¸ªåˆ°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pinia.use(<span class="function">(<span class="params">&#123; store &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  store.hello = <span class="string">'world'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä»»ä½•ç”±æ’ä»¶è¿”å›çš„å±æ€§éƒ½ä¼šè¢« devtools è‡ªåŠ¨è¿½è¸ªï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³åœ¨ devtools ä¸­è°ƒè¯• hello å±æ€§ï¼Œä¸ºäº†ä½¿ devtools èƒ½è¿½è¸ªåˆ° helloï¼Œè¯·ç¡®ä¿åœ¨ dev æ¨¡å¼ä¸‹å°†å…¶æ·»åŠ åˆ° store._customProperties ä¸­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸Šæ–‡ç¤ºä¾‹</span></span><br><span class="line">pinia.use(<span class="function">(<span class="params">&#123; store &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  store.hello = <span class="string">'world'</span></span><br><span class="line">  <span class="comment">// ç¡®ä¿ä½ çš„æ„å»ºå·¥å…·èƒ½å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œwebpack å’Œ vite åœ¨é»˜è®¤æƒ…å†µä¸‹åº”è¯¥èƒ½å¤„ç†ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ ä½ åœ¨ store ä¸­è®¾ç½®çš„é”®å€¼</span></span><br><span class="line">    store._customProperties.add(<span class="string">'hello'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="åœ¨ç»„ä»¶å¤–ä½¿ç”¨-store"><a href="#åœ¨ç»„ä»¶å¤–ä½¿ç”¨-store" class="headerlink" title="åœ¨ç»„ä»¶å¤–ä½¿ç”¨ store"></a>åœ¨ç»„ä»¶å¤–ä½¿ç”¨ store</h2><p>Pinia store ä¾é  <code>pinia</code> å®ä¾‹åœ¨æ‰€æœ‰è°ƒç”¨ä¸­å…±äº«åŒä¸€ä¸ª store å®ä¾‹ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œåªéœ€è°ƒç”¨ä½ å®šä¹‰çš„ <code>useStore()</code> å‡½æ•°ï¼Œå®Œå…¨å¼€ç®±å³ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>setup()</code> ä¸­ï¼Œä½ ä¸éœ€è¦å†åšä»»ä½•äº‹æƒ…ã€‚ä½†åœ¨ç»„ä»¶ä¹‹å¤–ï¼Œæƒ…å†µå°±æœ‰ç‚¹ä¸åŒäº†ã€‚ å®é™…ä¸Šï¼Œ<code>useStore()</code> ç»™ä½ çš„ <code>app</code> è‡ªåŠ¨æ³¨å…¥äº† <code>pinia</code> å®ä¾‹ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœ <code>pinia</code> å®ä¾‹ä¸èƒ½è‡ªåŠ¨æ³¨å…¥ï¼Œä½ å¿…é¡»æ‰‹åŠ¨æä¾›ç»™ <code>useStore()</code> å‡½æ•°ã€‚ ä½ å¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨ï¼Œä»¥ä¸åŒçš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="å•é¡µé¢åº”ç”¨"><a href="#å•é¡µé¢åº”ç”¨" class="headerlink" title="å•é¡µé¢åº”ç”¨"></a>å•é¡µé¢åº”ç”¨</h3><p>å¦‚æœä½ ä¸åšä»»ä½• SSR(æœåŠ¡å™¨ç«¯æ¸²æŸ“)ï¼Œåœ¨ç”¨ <code>app.use(pinia)</code> å®‰è£… pinia æ’ä»¶åï¼Œå¯¹ <code>useStore()</code> çš„ä»»ä½•è°ƒç”¨éƒ½ä¼šæ­£å¸¸æ‰§è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">'@/stores/user'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ  å¤±è´¥ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨åˆ›å»º pinia ä¹‹å‰è¢«è°ƒç”¨çš„</span></span><br><span class="line"><span class="keyword">const</span> userStore = useUserStore()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line">app.use(pinia)</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æˆåŠŸï¼Œå› ä¸º pinia å®ä¾‹ç°åœ¨æ¿€æ´»äº†</span></span><br><span class="line"><span class="keyword">const</span> userStore = useUserStore()</span><br></pre></td></tr></table></figure>
<p>ä¸ºç¡®ä¿ pinia å®ä¾‹è¢«æ¿€æ´»ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°† <code>useStore()</code> çš„è°ƒç”¨æ”¾åœ¨ pinia å®‰è£…åæ‰ä¼šæ‰§è¡Œçš„å‡½æ•°ä¸­ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåœ¨ Vue Router çš„å¯¼èˆªå®ˆå«ä¸­ä½¿ç”¨ store çš„ä¾‹å­ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ç”±äºå¼•å…¥é¡ºåºçš„é—®é¢˜ï¼Œè¿™å°†å¤±è´¥</span></span><br><span class="line"><span class="keyword">const</span> store = useStore()</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬æƒ³è¦åœ¨è¿™é‡Œä½¿ç”¨ store</span></span><br><span class="line">  <span class="keyword">if</span> (store.isLoggedIn) next()</span><br><span class="line">  <span class="keyword">else</span> next(<span class="string">'/login'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// âœ… è¿™æ ·åšæ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºè·¯ç”±å™¨æ˜¯åœ¨å…¶è¢«å®‰è£…ä¹‹åå¼€å§‹å¯¼èˆªçš„ï¼Œ</span></span><br><span class="line">  <span class="comment">// è€Œæ­¤æ—¶ Pinia ä¹Ÿå·²ç»è¢«å®‰è£…ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> store = useStore()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (to.meta.requiresAuth &amp;&amp; !store.isLoggedIn) <span class="keyword">return</span> <span class="string">'/login'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨"><a href="#æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨" class="headerlink" title="æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨"></a>æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨</h3><p>å½“å¤„ç†æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œä½ å°†å¿…é¡»æŠŠ <code>pinia</code> å®ä¾‹ä¼ é€’ç»™ <code>useStore()</code>ã€‚è¿™å¯ä»¥é˜²æ­¢ pinia åœ¨ä¸åŒçš„åº”ç”¨å®ä¾‹ä¹‹é—´å…±äº«å…¨å±€çŠ¶æ€ã€‚</p>
<h2 id="æœåŠ¡ç«¯æ¸²æŸ“-SSR"><a href="#æœåŠ¡ç«¯æ¸²æŸ“-SSR" class="headerlink" title="æœåŠ¡ç«¯æ¸²æŸ“ (SSR)"></a>æœåŠ¡ç«¯æ¸²æŸ“ (SSR)</h2><p>åªè¦ä½ åªåœ¨ <code>setup</code> å‡½æ•°ã€<code>getter</code> å’Œ <code>action</code> çš„é¡¶éƒ¨è°ƒç”¨ä½ å®šä¹‰çš„ <code>useStore()</code> å‡½æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨ Pinia åˆ›å»º store å¯¹äº SSR æ¥è¯´åº”è¯¥æ˜¯å¼€ç®±å³ç”¨çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="comment">// è¿™æ˜¯å¯è¡Œçš„ï¼Œ</span></span><br><span class="line"><span class="comment">// å› ä¸º pinia çŸ¥é“åœ¨ `setup` ä¸­è¿è¡Œçš„æ˜¯ä»€ä¹ˆç¨‹åºã€‚</span></span><br><span class="line"><span class="keyword">const</span> main = useMainStore()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="åœ¨-setup-å¤–éƒ¨ä½¿ç”¨-store"><a href="#åœ¨-setup-å¤–éƒ¨ä½¿ç”¨-store" class="headerlink" title="åœ¨ setup() å¤–éƒ¨ä½¿ç”¨ store"></a>åœ¨ setup() å¤–éƒ¨ä½¿ç”¨ store</h3><p>å¦‚æœä½ éœ€è¦åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ storeï¼Œä½ éœ€è¦å°†<strong>åŸæœ¬è¢«ä¼ é€’ç»™åº”ç”¨</strong> çš„ <code>pinia</code> å®ä¾‹ä¼ é€’ç»™ <code>useStore()</code> å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">app.use(router)</span><br><span class="line">app.use(pinia)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// âœ…è¿™ä¼šæ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå®ƒç¡®ä¿äº†æ­£ç¡®çš„ store è¢«ç”¨äº</span></span><br><span class="line">  <span class="comment">// å½“å‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> main = useMainStore(pinia)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (to.meta.requiresAuth &amp;&amp; !main.isLoggedIn) <span class="keyword">return</span> <span class="string">'/login'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Pinia ä¼šå°†è‡ªå·±ä½œä¸º <code>$pinia</code> æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ <code>serverPrefetch()</code> ç­‰å‡½æ•°ä¸­ä½¿ç”¨å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  serverPrefetch() &#123;</span><br><span class="line">    <span class="keyword">const</span> store = useStore(<span class="keyword">this</span>.$pinia)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="State-æ¿€æ´»"><a href="#State-æ¿€æ´»" class="headerlink" title="State æ¿€æ´»"></a>State æ¿€æ´»</h3><p>ä¸ºäº†æ¿€æ´»åˆå§‹ stateï¼Œä½ éœ€è¦ç¡®ä¿ rootState åŒ…å«åœ¨ HTML ä¸­çš„æŸä¸ªåœ°æ–¹ï¼Œä»¥ä¾¿ Pinia ç¨åèƒ½å¤Ÿæ¥æ”¶åˆ°å®ƒã€‚æ ¹æ®ä½ æœåŠ¡ç«¯æ‰€æ¸²æŸ“çš„å†…å®¹ï¼Œä¸ºäº†å®‰å…¨ä½ åº”è¯¥è½¬ä¹‰ stateã€‚æˆ‘ä»¬æ¨è Nuxt ç›®å‰ä½¿ç”¨çš„ <a href="https://github.com/nuxt-contrib/devalue" target="_blank" rel="noopener">@nuxt/devalue</a>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> devalue <span class="keyword">from</span> <span class="string">'@nuxt/devalue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="comment">// æ£€ç´¢æœåŠ¡ç«¯çš„ rootState</span></span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line">app.use(router)</span><br><span class="line">app.use(pinia)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸²æŸ“é¡µé¢åï¼ŒrootState è¢«å»ºç«‹ï¼Œ</span></span><br><span class="line"><span class="comment">// å¯ä»¥ç›´æ¥åœ¨ `pinia.state.value`ä¸Šè¯»å–ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åºåˆ—åŒ–ï¼Œè½¬ä¹‰(å¦‚æœ state çš„å†…å®¹å¯ä»¥è¢«ç”¨æˆ·æ”¹å˜ï¼Œè¿™ç‚¹å°±éå¸¸é‡è¦ï¼Œå‡ ä¹éƒ½æ˜¯è¿™æ ·çš„)</span></span><br><span class="line"><span class="comment">// å¹¶å°†å…¶æ”¾ç½®åœ¨é¡µé¢çš„æŸå¤„</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼Œä½œä¸ºä¸€ä¸ªå…¨å±€å˜é‡ã€‚</span></span><br><span class="line">devalue(pinia.state.value)</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä½ æœåŠ¡ç«¯æ‰€æ¸²æŸ“çš„å†…å®¹ï¼Œä½ å°†è®¾ç½®ä¸€ä¸ªåˆå§‹çŠ¶æ€å˜é‡ï¼Œè¯¥å˜é‡å°†åœ¨ HTML ä¸­è¢«åºåˆ—åŒ–ã€‚ä½ è¿˜åº”è¯¥ä¿æŠ¤è‡ªå·±å…å— XSS æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œåœ¨ <a href="https://github.com/frandiox/vite-ssr" target="_blank" rel="noopener">vite-ssr</a>ä¸­ä½ å¯ä»¥ä½¿ç”¨transformState é€‰é¡¹ ä»¥åŠ <a href="https://github.com/frandiox/vite-ssr#state-serialization" target="_blank" rel="noopener">@nuxt/devalue</a>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> devalue <span class="keyword">from</span> <span class="string">'@nuxt/devalue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> viteSSR(</span><br><span class="line">  App,</span><br><span class="line">  &#123;</span><br><span class="line">    routes,</span><br><span class="line">    transformState(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">import</span>.meta.env.SSR ? devalue(state) : state</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  (&#123; initialState &#125;) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">import</span>.meta.env.SSR) &#123;</span><br><span class="line">      <span class="comment">// åºåˆ—åŒ–å¹¶è®¾ç½®ä¸º window.__INITIAL_STATE__</span></span><br><span class="line">      initialState.pinia = pinia.state.value</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬æ¢å¤ state</span></span><br><span class="line">      pinia.state.value = initialState.pinia</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦ä½¿ç”¨ <code>@nuxt/devalue</code> çš„<strong>å…¶ä»–æ›¿ä»£å“</strong>ï¼Œä¾‹å¦‚ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ <code>JSON.stringify()/JSON.parse()</code> æ¥åºåˆ—åŒ–å’Œè§£æä½ çš„ stateï¼Œè¿™æ ·ä½ å¯ä»¥æŠŠæ€§èƒ½æé«˜å¾ˆå¤šã€‚</p>
<p>ä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„ç¯å¢ƒè°ƒæ•´è¿™ä¸ªç­–ç•¥ã€‚ä½†ç¡®ä¿åœ¨å®¢æˆ·ç«¯è°ƒç”¨ä»»ä½• <code>useStore()</code> å‡½æ•°ä¹‹å‰ï¼Œæ¿€æ´» pinia çš„ stateã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°† state åºåˆ—åŒ–ä¸ºä¸€ä¸ª <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯é€šè¿‡ <code>window.__pinia</code> å…¨å±€è®¿é—®å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line">app.use(pinia)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»ç”±ç”¨æˆ·è®¾ç½®</span></span><br><span class="line"><span class="keyword">if</span> (isClient) &#123;</span><br><span class="line">  pinia.state.value = <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.__pinia)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Nuxt"><a href="#Nuxt" class="headerlink" title="Nuxt"></a>Nuxt</h3><p>æ­é… <strong>Nuxt</strong> çš„ Pinia æ›´æ˜“ç”¨ï¼Œå› ä¸º Nuxt å¤„ç†äº†å¾ˆå¤šä¸æœåŠ¡å™¨ç«¯æ¸²æŸ“æœ‰å…³çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œä½ ä¸éœ€è¦å…³å¿ƒåºåˆ—åŒ–æˆ– XSS æ”»å‡»ã€‚Pinia æ—¢æ”¯æŒ Nuxt Bridge å’Œ Nuxt 3ï¼Œä¹Ÿæ”¯æŒçº¯ Nuxt 2ã€‚</p>
<h4 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add pinia @pinia/nuxt</span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ npm</span></span><br><span class="line">npm install pinia @pinia/nuxt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ npmï¼Œä½ å¯èƒ½ä¼šé‡åˆ° ERESOLVE unable to resolve dependency tree é”™è¯¯ã€‚å¦‚æœé‚£æ ·çš„è¯ï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° package.json ä¸­ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"overrides"</span>: &#123;</span><br><span class="line">    <span class="attr">"vue"</span>: <span class="string">"latest"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <strong><em>module</em></strong> æ¥ä¸ºä½ å¤„ç†ä¸€åˆ‡ï¼Œä½ åªéœ€è¦åœ¨ <code>nuxt.config.js</code> æ–‡ä»¶çš„ <code>modules</code> ä¸­æ·»åŠ å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  <span class="comment">// ... å…¶ä»–é…ç½®</span></span><br><span class="line">  modules: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="string">'@pinia/nuxt'</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·é…ç½®å°±å®Œæˆäº†ï¼Œæ­£å¸¸ä½¿ç”¨ store å°±å¥½å•¦!</p>
<h4 id="åœ¨-setup-å¤–éƒ¨ä½¿ç”¨-store-1"><a href="#åœ¨-setup-å¤–éƒ¨ä½¿ç”¨-store-1" class="headerlink" title="åœ¨ setup() å¤–éƒ¨ä½¿ç”¨ store"></a>åœ¨ setup() å¤–éƒ¨ä½¿ç”¨ store</h4><p>å¦‚æœä½ æƒ³åœ¨ <code>setup()</code> å¤–éƒ¨ä½¿ç”¨ä¸€ä¸ª storeï¼Œè®°å¾—æŠŠ <code>pinia</code> å¯¹è±¡ä¼ ç»™ <code>useStore()</code>ã€‚æˆ‘ä»¬ä¼šæŠŠå®ƒæ·»åŠ åˆ°<strong>ä¸Šä¸‹æ–‡</strong>ä¸­ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨ <code>asyncData()</code> å’Œ <code>fetch()</code> ä¸­è®¿é—®å®ƒäº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">'~/stores/myStore'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  asyncData(&#123; $pinia &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> store = useStore($pinia)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ <code>onServerPrefetch()</code> ä¸€æ ·ï¼Œå¦‚æœä½ æƒ³åœ¨ a<code>syncData()</code> ä¸­è°ƒç”¨ä¸€ä¸ªå­˜å‚¨åŠ¨ä½œï¼Œä½ ä¸éœ€è¦åšä»»ä½•ç‰¹åˆ«çš„äº‹æƒ…ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> store = useStore()</span><br><span class="line"><span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> useAsyncData(<span class="string">'user'</span>, () =&gt; store.fetchUser())</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="è‡ªåŠ¨å¼•å…¥"><a href="#è‡ªåŠ¨å¼•å…¥" class="headerlink" title="è‡ªåŠ¨å¼•å…¥"></a>è‡ªåŠ¨å¼•å…¥</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>@pinia/nuxt</code> ä¼šæš´éœ²ä¸€ä¸ªè‡ªåŠ¨å¼•å…¥çš„æ–¹æ³•ï¼š<code>usePinia()</code>ï¼Œå®ƒç±»ä¼¼äº <code>getActivePinia()</code>ï¼Œä½†åœ¨ Nuxt ä¸­æ•ˆæœæ›´å¥½ã€‚ä½ å¯ä»¥æ·»åŠ è‡ªåŠ¨å¼•å…¥æ¥å‡è½»ä½ çš„å¼€å‘å·¥ä½œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  <span class="comment">// ... å…¶ä»–é…ç½®</span></span><br><span class="line">  modules: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">'@pinia/nuxt'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        autoImports: [</span><br><span class="line">          <span class="comment">// è‡ªåŠ¨å¼•å…¥ `defineStore()`</span></span><br><span class="line">          <span class="string">'defineStore'</span>,</span><br><span class="line">          <span class="comment">// è‡ªåŠ¨å¼•å…¥ `defineStore()` å¹¶é‡å‘½åä¸º `definePiniaStore()`</span></span><br><span class="line">          [<span class="string">'defineStore'</span>, <span class="string">'definePiniaStore'</span>],</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="çº¯-Nuxt-2"><a href="#çº¯-Nuxt-2" class="headerlink" title="çº¯ Nuxt 2"></a>çº¯ Nuxt 2</h4><p><code>@pinia/nuxt</code> v0.2.1 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒPinia éƒ½æ”¯æŒ Nuxt 2ã€‚è¯·ç¡®ä¿åœ¨å®‰è£… pinia çš„åŒæ—¶ä¹Ÿå®‰è£… <a href="https://composition-api.nuxtjs.org/" target="_blank" rel="noopener">@nuxtjs/composition-api</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add pinia @pinia/nuxt@0.2.1 @nuxtjs/composition-api</span><br><span class="line"><span class="comment"># ä½¿ç”¨ npm</span></span><br><span class="line">npm install pinia @pinia/nuxt@0.2.1 @nuxtjs/composition-api</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <strong><em>module</em></strong> æ¥ä¸ºä½ å¤„ç†ä¸€åˆ‡å·¥ä½œï¼Œä½ åªéœ€è¦åœ¨ <code>nuxt.config.js</code> æ–‡ä»¶çš„ <code>buildModules</code> ä¸­æ·»åŠ å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ... å…¶ä»–é…ç½®</span></span><br><span class="line">  buildModules: [</span><br><span class="line">    <span class="comment">// ä»…æ”¯æŒ Nuxt 2:</span></span><br><span class="line">    <span class="comment">// https://composition-api.nuxtjs.org/getting-started/setup#quick-start</span></span><br><span class="line">    <span class="string">'@nuxtjs/composition-api/module'</span>,</span><br><span class="line">    <span class="string">'@pinia/nuxt'</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Pinia-æ­é…-Vuex-ä½¿ç”¨"><a href="#Pinia-æ­é…-Vuex-ä½¿ç”¨" class="headerlink" title="Pinia æ­é… Vuex ä½¿ç”¨"></a>Pinia æ­é… Vuex ä½¿ç”¨</h4><p>å»ºè®®é¿å…åŒæ—¶ä½¿ç”¨ Pinia å’Œ Vuexï¼Œä½†å¦‚æœä½ ç¡®å®éœ€è¦åŒæ—¶ä½¿ç”¨ï¼Œä½ éœ€è¦å‘Šè¯‰ Pinia ä¸è¦ç¦ç”¨å®ƒï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  buildModules: [</span><br><span class="line">    <span class="string">'@nuxtjs/composition-api/module'</span>,</span><br><span class="line">    [<span class="string">'@pinia/nuxt'</span>, &#123; <span class="attr">disableVuex</span>: <span class="literal">false</span> &#125;],</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ... å…¶ä»–é…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>





<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "7fbe80427f54741e289f",
        clientSecret: "f34ed5fd92e54c9000bd37ba951948cb939deff5",
        repo: "sanonz.github.io",
        owner: "sanonz",
        admin: ["sanonz"],
        id: "2025/06/10/pina",
        distractionFreeMode: true,
        title: "å†è¯» pinia å®˜æ–¹æ–‡æ¡£",
        body: "http://www.shuy.cc/2025/06/10/pina/",
        labels: []
    }).render('comments');
    </script>
</div>


        </div>
        <footer class="footer" style="color: #fff">
    <a href="https://beian.miit.gov.cn/" style="color: #fff" target="_blank">æ™‹ICPå¤‡2024043727å·-3</a>
</footer>

    </main>

    <script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle('normal', slideDone);
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp('normal', slideDone);
            }, 3000);
        }

        function slideDone() {
            if (nodes.navInner.css('display') !== 'none') {
                nodes.navInner.css('display', '');
            }
        }

        $(window).on('resize', function() {
            console.log($(this).width())
            if ($(this).width() > 960) {
                nodes.navInner.css('display', '');
            }
        });
    });
    </script>
    
        <script src="/js/scrollspy.min.js"></script>
        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});

        $(window).on('resize', function() {
            var hw = $('#header').width();
            var ww = $('#wrapper').width();
            var space = ($(this).width() - hw - ww) / 2 / 2;

            var pageprev = $('#pageprev');
            var pagenext = $('#pagenext');
            var avg = (pageprev.width() + pagenext.width()) / 2

            if(space > avg) {
                var len = space - avg / 2;
                // var styles = {position: 'fixed', top: '50%', marginTop: - (pageprev.width() + pagenext.width()) / 4}
                // pageprev.css($.extend({left: hw + len}, styles));
                // pagenext.css($.extend({right: len}, styles));
            } else {
                pageprev.removeAttr('style');
                // pagenext.removeAttr('style');
            }
        }).trigger('resize');
        </script>
    

</body>
</html>
