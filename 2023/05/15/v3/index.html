<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>vue3和vue2的区别整理 | 前端技术博客</title>
    <meta name="author" content="xiaosongread">
    <meta name="keywords" content="小宋 抿圪斗前端 前端 前端博客 框架 工程 css html js node markdown npm webpack">
    <meta name="description" content="api及语法双向绑定原理Vue2使用Object.defineProperty 为每个属性创建getter和setter，通过getter和setter来捕获操作以实现响应式更新； 很多情况下，属性的新增和删除拦截不到（比如数组的长度变化）Vue3使用Proxy，Proxy可以拦截对象和数组的变化，包括新增和删除属性，数组的长度变化等，从而实现更精确的响应式更新v2 使用object.defineProperty来劫持数据的setter和getter方法，对象改变需要借助api去...">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="/atom.xml" title="前端技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    <link rel="stylesheet" href="/css/style.css">

    <!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
</head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">前端技术博客</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">列表</span>
            </a>
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/categories/css-end/">
                <span class="nav-text">css</span>
            </a>
        
            <a class="nav-item" href="/categories/js-end/">
                <span class="nav-text">js</span>
            </a>
        
            <a class="nav-item" href="/categories/gc-end/">
                <span class="nav-text">工程</span>
            </a>
        
            <a class="nav-item" href="/categories/sh-end/">
                <span class="nav-text">日常</span>
            </a>
        
            <a class="nav-item" href="/categories/jq-end/">
                <span class="nav-text">每日技巧</span>
            </a>
        
            <a class="nav-item" href="/categories/my-end/">
                <span class="nav-text">关于我</span>
            </a>
        
    </nav>
</div>

    
<aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#api及语法"><span class="toc-number">1.</span> <span class="toc-text">api及语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#双向绑定原理"><span class="toc-number">1.1.</span> <span class="toc-text">双向绑定原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue3支持碎片化"><span class="toc-number">1.2.</span> <span class="toc-text">vue3支持碎片化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生命周期"><span class="toc-number">1.3.</span> <span class="toc-text">生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#去除this"><span class="toc-number">1.4.</span> <span class="toc-text">去除this</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组件传值props和emit"><span class="toc-number">1.5.</span> <span class="toc-text">组件传值props和emit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#watch和computed"><span class="toc-number">1.6.</span> <span class="toc-text">watch和computed</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#watch"><span class="toc-number">1.6.1.</span> <span class="toc-text">watch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#computed"><span class="toc-number">1.6.2.</span> <span class="toc-text">computed</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#子组件实例，调用组件方法"><span class="toc-number">1.7.</span> <span class="toc-text">子组件实例，调用组件方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选项式api和组合式api"><span class="toc-number">1.8.</span> <span class="toc-text">选项式api和组合式api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mixins和hooks"><span class="toc-number">1.9.</span> <span class="toc-text">mixins和hooks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插件"><span class="toc-number">2.</span> <span class="toc-text">插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vue-router"><span class="toc-number">2.1.</span> <span class="toc-text">vue-router</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#状态管理Vuex-和-Pinia"><span class="toc-number">2.2.</span> <span class="toc-text">状态管理Vuex 和 Pinia</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pina"><span class="toc-number">3.</span> <span class="toc-text">pina</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pinia是什么"><span class="toc-number">3.0.1.</span> <span class="toc-text">Pinia是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pinia使用"><span class="toc-number">3.0.2.</span> <span class="toc-text">Pinia使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#state"><span class="toc-number">3.0.2.1.</span> <span class="toc-text">state</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#读取state"><span class="toc-number">3.0.2.1.1.</span> <span class="toc-text">读取state</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#修改state"><span class="toc-number">3.0.2.1.2.</span> <span class="toc-text">修改state</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#批量修改state"><span class="toc-number">3.0.2.1.3.</span> <span class="toc-text">批量修改state</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#重置state"><span class="toc-number">3.0.2.1.4.</span> <span class="toc-text">重置state</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#直接替换整个state（几乎不用）"><span class="toc-number">3.0.2.1.5.</span> <span class="toc-text">直接替换整个state（几乎不用）</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getters"><span class="toc-number">3.0.2.2.</span> <span class="toc-text">getters</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#类似计算属性。推荐里面传递一个形参的写法，不容易出错"><span class="toc-number">3.0.2.2.1.</span> <span class="toc-text">类似计算属性。推荐里面传递一个形参的写法，不容易出错</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#调用本模块其他getters"><span class="toc-number">3.0.2.2.2.</span> <span class="toc-text">调用本模块其他getters</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#getters传参"><span class="toc-number">3.0.2.2.3.</span> <span class="toc-text">getters传参</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#调用其他store里面的getter"><span class="toc-number">3.0.2.2.4.</span> <span class="toc-text">调用其他store里面的getter</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#actions"><span class="toc-number">3.0.2.3.</span> <span class="toc-text">actions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#模块化"><span class="toc-number">3.0.2.4.</span> <span class="toc-text">模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#随便建立两个store，并导出"><span class="toc-number">3.0.2.4.1.</span> <span class="toc-text">随便建立两个store，并导出</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#新建store-index-js"><span class="toc-number">3.0.2.4.2.</span> <span class="toc-text">新建store/index.js</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#组件中使用"><span class="toc-number">3.0.2.4.3.</span> <span class="toc-text">组件中使用</span></a></li></ol></li></ol></li></ol></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            vue3和vue2的区别整理
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://www.shuy.cc/2023/05/15/v3/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2023-05-15T06:48:08.000Z" itemprop="datePublished">2023-05-15</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="api及语法"><a href="#api及语法" class="headerlink" title="api及语法"></a>api及语法</h2><h3 id="双向绑定原理"><a href="#双向绑定原理" class="headerlink" title="双向绑定原理"></a>双向绑定原理</h3><ul>
<li>Vue2使用Object.defineProperty 为每个属性创建getter和setter，通过getter和setter来捕获操作以实现响应式更新； 很多情况下，属性的新增和删除拦截不到（比如数组的长度变化）</li>
<li>Vue3使用Proxy，Proxy可以拦截对象和数组的变化，包括新增和删除属性，数组的长度变化等，从而实现更精确的响应式更新</li>
</ul>
<blockquote>
<p>v2 使用object.defineProperty来劫持数据的setter和getter方法，对象改变需要借助api去深度监听;<br>v3 使用proxy来劫持整个对象，不需要深度监听，性能更好,删除了一些api($on,$once,$off) fiter等，优化了Block tree,solt,diff 算法等</p>
</blockquote>
<p>Vue2在data中定义的数据就会自动遍历绑定Object.defineProperty以实现响应式；Vue3中要用ref包装，通过返回值的 .value属性获取响应式的值 ，修改也需要对 .value进行修改.</p>
<a id="more"></a>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不需要.value --&gt;</span></span><br><span class="line"> &#123;&#123; testOne &#125;&#125;</span><br><span class="line"> &#123;&#123; testTwo.directionD&#125;&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testOne= ref(<span class="number">0</span>)</span></span><br><span class="line">  </span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testTwo= ref(&#123;</span></span><br><span class="line"><span class="javascript">    directionD: <span class="string">''</span>,</span></span><br><span class="line"><span class="javascript">    directionA: <span class="string">''</span>,</span></span><br><span class="line">    arr: []</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> dataThree= ref(&#123;&#125;)</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript">  <span class="comment">// 使用需要.value</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(testOne.value);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(dataThree.value);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(testTwo.value.directionD);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(testTwo.value.directionD);</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>二者用法差异不在此赘述，可见大佬文章：<a href="http://t.csdnimg.cn/wpu6r" target="_blank" rel="noopener">http://t.csdnimg.cn/wpu6r</a></p>
<h3 id="vue3支持碎片化"><a href="#vue3支持碎片化" class="headerlink" title="vue3支持碎片化"></a>vue3支持碎片化</h3><ul>
<li>Vue2中，每个组件必须有一个根元素，而Vue3中，组件可以没有根元素，可以返回一个数组，数组中的每个元素都可以是一个独立的组件</li>
<li>Vue3中，组件可以返回一个数组，数组中的每个元素都可以是一个独立的组件，这样就可以实现更灵活的布局和组件组合</li>
</ul>
<blockquote>
<p>下列情况若子组件中存在多个根节点， 则使用组件时不能使用 v-show（无法对子组件根节点添加display）<br>解决：<br>1.可用v-if代替（可能存在首次渲染失效）<br>2.只保留一个根节点</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 此时v-show无效 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">son</span>  <span class="attr">v-show</span>=<span class="string">"false"</span>&gt;</span><span class="tag">&lt;/<span class="name">son</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">-- son组件 --</span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"son_container"</span>&gt;</span></span><br><span class="line">     1</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"son_container2"</span>&gt;</span></span><br><span class="line">     2</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"son_container3"</span>&gt;</span></span><br><span class="line">     3</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><table>
<thead>
<tr>
<th>vue2</th>
<th>vue3</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>beforeCreate()</td>
<td>setup()</td>
<td>组件开始创建数据实例之前</td>
</tr>
<tr>
<td>created()</td>
<td>setup()</td>
<td>组件实例完成</td>
</tr>
<tr>
<td>beforeMount()</td>
<td>onBeforeMount()</td>
<td>DOM挂载之前</td>
</tr>
<tr>
<td>mounted()</td>
<td>onMounted()</td>
<td>DOM挂载完成</td>
</tr>
<tr>
<td>beforeUpdate()</td>
<td>onBeforeUpdate()</td>
<td>组件更新之前</td>
</tr>
<tr>
<td>undated()</td>
<td>onUpdated()</td>
<td>组件更新之后</td>
</tr>
<tr>
<td>beforeDestroy()</td>
<td>onBeforeunmount()</td>
<td>组件销毁之前</td>
</tr>
<tr>
<td>destroyed()</td>
<td>onUnmounted()</td>
<td>组件销毁之后</td>
</tr>
</tbody>
</table>
<h3 id="去除this"><a href="#去除this" class="headerlink" title="去除this"></a>去除this</h3><pre><code>Vue3中没有this， 使用this报错 需要组件内的某个方法直接使用即可（注意使用的数据必须在调用前定义）
</code></pre><h3 id="组件传值props和emit"><a href="#组件传值props和emit" class="headerlink" title="组件传值props和emit"></a>组件传值props和emit</h3><ul>
<li>Vue2中是 props和 this.$emit    </li>
<li>Vue3中则是[defineEmits defineProps] props emit；</li>
</ul>
<blockquote>
<p>需要注意的是 Vue2中传值给子组件的属性可以直接使用，<br>Vue3中子组件接收的值在props对象中，所以在ts/js中使用需要 props.name,<br>emit触发的事件，需要defineProps声明接收数据，defineEmits 声明以明确事件定义.</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父组件中使用子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">son</span> <span class="attr">ref</span>=<span class="string">"bottomContract"</span> </span></span><br><span class="line"><span class="tag">     @<span class="attr">transferData</span>=<span class="string">"transferData"</span> </span></span><br><span class="line"><span class="tag">     @<span class="attr">reloadEcharts</span>=<span class="string">"reloadEcharts"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">:dataOne</span>=<span class="string">"tableTime"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">:dataTwo</span>=<span class="string">"echartsColumnData"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">:dataThree</span>=<span class="string">"dataThree"</span> </span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"ts"</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//子组件中接收</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> props = defineProps(&#123;</span></span><br><span class="line">      dataOne: &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="number">0</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      dataThree: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Number</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="number">0</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      dataTwo: &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> []</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="javascript">  <span class="comment">// 也可以数组形式</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// const emit = defineEmits(["dataFour", "dataFive", "dataSix"])</span></span></span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="comment">// 子组件中使用</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> test = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(props.dataOne)</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="comment">// defineEmits明确事件定义</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> emit = defineEmits([<span class="string">"transferData"</span>, <span class="string">"reloadEcharts"</span>])</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="keyword">const</span> testTwo = <span class="function"><span class="params">()</span>=&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    emit(<span class="string">"transferData"</span>, <span class="string">'value'</span>)</span></span><br><span class="line"><span class="javascript">    emit(<span class="string">"transferData"</span>, <span class="string">'value'</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="watch和computed"><a href="#watch和computed" class="headerlink" title="watch和computed"></a>watch和computed</h3><h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><ul>
<li>Vue2中是watch</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  scrollTop(n) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Vue3，监听watch第一个参数是直接传入要监听的对象 ；深度监听复杂对象 {deep： true}</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> demo = reactive(&#123;</span><br><span class="line">	name: <span class="string">'前端'</span>,</span><br><span class="line">	nickName: <span class="string">'1'</span>,</span><br><span class="line">	Yiqian: &#123;</span><br><span class="line">		name: <span class="string">''</span>,</span><br><span class="line">		nickName: <span class="string">''</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 深度监听复杂对象 &#123;deep： true&#125;</span></span><br><span class="line">watch(demo, (newValue, oldValue) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'watch 已触发'</span>, newValue)</span><br><span class="line">&#125;， &#123;deep： <span class="literal">true</span>&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 也可以只监听其中的某个属性</span></span><br><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> <span class="function">(<span class="params">&#123; ...demo &#125;</span>), (<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'watch 已触发'</span>, newValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>&gt;&gt;&gt; 监听一个属性就要用一个watch，是不是不太妙？ 那当然也可以组合到一起，此时的第一个参数是一个数组，第二参数箭头函数的参数也是数组的形式，按照数组下标对应监听值

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> [demo.name, demo.nickname], (newValue, oldValue) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue); <span class="comment">// 此时newValue是数组，按照数据下标获取对应监听属性值</span></span><br><span class="line">  <span class="built_in">console</span>.log(newValue[<span class="number">0</span>])</span><br><span class="line">  <span class="built_in">console</span>.log(newValue[<span class="number">1</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h4><p>与vue2的computed配置写法基本一致 .</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = ref(&#123;</span><br><span class="line">   testOne: <span class="string">'A'</span>,</span><br><span class="line">   testTwo: <span class="string">'B'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有getter的计算属性</span></span><br><span class="line">  <span class="keyword">const</span> fullName1 = computed(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> user.value.testOne+ <span class="string">'-'</span> + user.value.testTwo;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有getter与setter的计算属性</span></span><br><span class="line"><span class="keyword">const</span> fullName2 = computed(&#123;</span><br><span class="line">  <span class="keyword">get</span> () &#123;</span><br><span class="line">    <span class="keyword">return</span> user.value.testOne+ <span class="string">'-'</span> + user.value.testTwo;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> (value: string) &#123;</span><br><span class="line">    <span class="keyword">const</span> names =<span class="string">'111'</span>;</span><br><span class="line">    user.value.testOne= names;</span><br><span class="line">    user.value.testTwo= names;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="子组件实例，调用组件方法"><a href="#子组件实例，调用组件方法" class="headerlink" title="子组件实例，调用组件方法"></a>子组件实例，调用组件方法</h3><ul>
<li>Vue2中 子组件定义<code>ref=&quot;name&quot;</code>后使用<code>this.$refs.name</code> 就能拿到组件<code>name</code>的实例；同时可以<code>this.$refs.name.test()</code> 的方式直接调用子组件的<code>test()</code>方法</li>
<li>Vue3中，子组件定义<code>ref=&quot;name&quot;</code>，需要用<code>ref()</code>来定义引用，将其绑定到对应子组件上；若想直接调用子组件的方法，需要在子组件中<code>defineExpose</code>显示暴露出对应的方法（组件封装性），若不暴露出来则子组件实例上不会存在此方法</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- -----父组件------ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">ref</span>=<span class="string">"timingEchartsModule"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> ChildComponent <span class="keyword">from</span> <span class="string">'./ChildComponent.vue'</span>;</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="comment">// 定义一个 ref 来引用子组件实例</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> timingEchartsModule = ref();</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="comment">// 在某个生命周期钩子中访问子组件实例</span></span></span><br><span class="line"><span class="javascript">onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(timingEchartsModule.value);</span></span><br><span class="line"><span class="javascript">  timingEchartsModule.value.test() <span class="comment">//调用子组件方法</span></span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- ----子组件---- --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> test= <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">'someMethod called'</span>);</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="comment">// defineExpose暴露方法  若不暴露，此方法不会存在组件实例上</span></span></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  test</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="选项式api和组合式api"><a href="#选项式api和组合式api" class="headerlink" title="选项式api和组合式api"></a>选项式api和组合式api</h3><ul>
<li><p>Vue2中 选项式的api，创建组件时需要使用各种选项 data methods  watch等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">'Hello Vue!'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    greet() &#123;</span><br><span class="line">      alert(message.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    message(newValue, oldValue) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Vue3组合式允许将相关的代码逻辑放在一起处理，让代码更易于理解和维护</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> message = ref(<span class="string">'Hello Vue!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> greet = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  alert(message.value);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> test = computed(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> meaages</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> message, (newValue: any, <span class="attr">oldValue</span>: any) =&gt; &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="mixins和hooks"><a href="#mixins和hooks" class="headerlink" title="mixins和hooks"></a>mixins和hooks</h3><ul>
<li><p>Vue 2 中，Mixins 是一种全局特性，可以在多个组件之间共享代码。你可以创建一个 Mixin 对象，然后在组件中通过 Mixins 选项引入这个对象，从而将 Mixin 中的属性和方法合并到组件中；如果多个 Mixins 中有相同的属性或方法，可能会导致命名冲突。另外，由于 Mixins 是全局的，它们会增加组件的耦合度，使得代码难以维护。</p>
</li>
<li><p>Vue3的Hooks允许你将相关的逻辑组合到一起，形成一个逻辑单元，组件内部使用的，而不是全局的，这减少了命名冲突和耦合度。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> count = ref(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">const</span> add = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">		count.value++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">const</span> decrement = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">		count.value--;   </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 把方法和数据返回出去</span></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">	    count,</span><br><span class="line">	    add,</span><br><span class="line">	    decrement</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在用到的文件中引入此hook.js 文件</span></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">	<span class="comment">// 引入hooks文件</span></span><br><span class="line">	<span class="keyword">import</span> useCount <span class="keyword">from</span> <span class="string">"../hooks/useCount"</span></span><br><span class="line">	<span class="comment">// 导入</span></span><br><span class="line">	<span class="keyword">const</span> &#123; count, add, decrement &#125; = useCount()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a>vue-router</h3><pre><code>基本类似，在使用时需要引入； route和router， router获取路由器实例 ; route对象包含了当前路由的各种信息
</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import &#123; useRouter, useRoute &#125; from 'vue-router'</span></span><br><span class="line"><span class="keyword">const</span> router = useRouter() <span class="comment">// 此为引入router</span></span><br><span class="line">router.push(&#123;<span class="attr">path</span>:<span class="string">'name'</span>&#125;)</span><br><span class="line">router.back();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> route = useRoute() <span class="comment">// 此为引入route</span></span><br><span class="line"><span class="built_in">console</span>.log(route.params)</span><br><span class="line"><span class="built_in">console</span>.log(route.query)</span><br></pre></td></tr></table></figure>
<h3 id="状态管理Vuex-和-Pinia"><a href="#状态管理Vuex-和-Pinia" class="headerlink" title="状态管理Vuex 和 Pinia"></a>状态管理Vuex 和 Pinia</h3><ul>
<li>Vuex使用 store、state、mutations、actions 和 getters 的概念，结构化更严格</li>
<li>Pinia 更简洁和模块化，使用 defineStore 函数创建状态，避免了冗长的代码结构</li>
</ul>
<!-- 详细使用步骤见大佬文章：http://t.csdnimg.cn/mgdAX -->
<h2 id="pina"><a href="#pina" class="headerlink" title="pina"></a>pina</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> useTimingInfoStore = defineStore(<span class="string">'timingApproval'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    testOne:  <span class="number">1</span>, </span><br><span class="line">    testTwo:  <span class="number">2</span>, </span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    addSchemeData(data)&#123;</span><br><span class="line">      <span class="keyword">this</span>.testOne= data</span><br><span class="line">    &#125;,</span><br><span class="line">    addTimingData(data)&#123;</span><br><span class="line">      <span class="keyword">this</span>.testTwo= data</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount: <span class="function">(<span class="params">state</span>) =&gt;</span> state.testOne* <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useTimingInfoStore</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 组件中使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; useTimingInfoStore&#125; <span class="keyword">from</span> <span class="string">'@/stores/timingApproval'</span>;</span><br><span class="line"><span class="keyword">const</span> timingInfoStore = useTimingInfoStore()</span><br><span class="line"><span class="built_in">console</span>.log(timingInfoStore.testOne)</span><br><span class="line"> </span><br><span class="line">timingInfoStore.addSchemeData(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>一、<a href="#Pinia是什么">Pinia是什么</a><br>二、<a href="#Pinia使用">Pinia使用</a><br>  <a href="#基本使用">1.基本使用</a><br>  <a href="#state">2.state</a><br>  <a href="#getters">3.getters</a><br>  <a href="#actions">4.actions</a><br>  <a href="#模块化">5.模块化</a></p>
<h4 id="Pinia是什么"><a href="#Pinia是什么" class="headerlink" title="Pinia是什么"></a>Pinia是什么</h4><p>伴随vue2到vue3的升级，官方已经用Pinia代替了Vuex成为官方的状态管理库。</p>
<p><img src="/images/img-folder/2024/pina.jpg"></p>
<p><img src="/images/img-folder/2024/pina1.jpg"></p>
<blockquote>
<p>所以，推荐使用Pinia作为以后不论是vue2还是vue3状态管理库的首选！</p>
</blockquote>
<h4 id="Pinia使用"><a href="#Pinia使用" class="headerlink" title="Pinia使用"></a>Pinia使用</h4><ul>
<li>安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add pinia</span><br><span class="line"># 或者使用 npm</span><br><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>
<p>在mian.js中，创建根存储</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line">app.use(createPinia())</span><br></pre></td></tr></table></figure>
<ul>
<li>创建store</li>
</ul>
<p><code>store</code>实例相当于一个容器，里面存放的有类似于<code>data</code>，计算属性，方法之类的东西。通过<code>defineStore()</code>方法定义</p>
<p>在src下面创建一个<code>store</code>文件夹，再创建与之对应的js文件，比如<code>user.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line">​</span><br><span class="line"><span class="comment">// useStore 可以是 useUser、useCart 之类的任何东西</span></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUser = defineStore(<span class="string">'user'</span>, &#123;</span><br><span class="line">  <span class="comment">// other options...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用store</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useUser &#125; <span class="keyword">from</span> <span class="string">'@/store/user.js'</span></span><br><span class="line"><span class="keyword">const</span> store = useUser()</span><br><span class="line"><span class="built_in">console</span>.log(store)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>添加state</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line">​</span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="comment">// 第二个参数是配置对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUser = defineStore(<span class="string">'user'</span>, &#123;</span><br><span class="line">  <span class="comment">// state是一个函数，返回一个对象</span></span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      userName: <span class="string">'jack'</span>,</span><br><span class="line">      avatar: <span class="string">'https://cloudflare-ipfs.com/ipfs/Qmd3W5DuhgHirLHGVixi6V76LhCkZUz6pnFt5AJBiyvHye/avatar/363.jpg'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="state"><a href="#state" class="headerlink" title="state"></a>state</h5><h6 id="读取state"><a href="#读取state" class="headerlink" title="读取state"></a>读取state</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"><span class="keyword">const</span> userStore = useUser()</span><br><span class="line"><span class="comment">// 如果直接解构出数据，这个数据不是响应式的。如果想要变成响应式的，需要调用storeToRefs方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; userName, avatar &#125; = storeToRefs(userStore)</span><br></pre></td></tr></table></figure>
<h6 id="修改state"><a href="#修改state" class="headerlink" title="修改state"></a>修改state</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userStore.userName = <span class="string">'张三'</span></span><br></pre></td></tr></table></figure>
<h6 id="批量修改state"><a href="#批量修改state" class="headerlink" title="批量修改state"></a>批量修改state</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以用来修改单个属性</span></span><br><span class="line">userStore.$patch(&#123;</span><br><span class="line">  userName: <span class="string">'张三'</span></span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 这种回调函数的形式适合修改集合类的数据，比如数组</span></span><br><span class="line">userStore.$patch(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  state.avatar = <span class="string">'https://cloudflare-ipfs.com/ipfs/Qmd3W5DuhgHirLHGVixi6V76LhCkZUz6pnFt5AJBiyvHye/avatar/596.jpg'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="重置state"><a href="#重置state" class="headerlink" title="重置state"></a>重置state</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userStore.$reset()</span><br></pre></td></tr></table></figure>
<h6 id="直接替换整个state（几乎不用）"><a href="#直接替换整个state（几乎不用）" class="headerlink" title="直接替换整个state（几乎不用）"></a>直接替换整个state（几乎不用）</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userStore.$state = &#123; <span class="attr">userName</span>: <span class="string">'rose'</span>, <span class="attr">avatar</span>: <span class="string">'https://cloudflare-ipfs.com/ipfs/Qmd3W5DuhgHirLHGVixi6V76LhCkZUz6pnFt5AJBiyvHye/avatar/854.jpg'</span> &#125;</span><br></pre></td></tr></table></figure>
<h5 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h5><h6 id="类似计算属性。推荐里面传递一个形参的写法，不容易出错"><a href="#类似计算属性。推荐里面传递一个形参的写法，不容易出错" class="headerlink" title="类似计算属性。推荐里面传递一个形参的写法，不容易出错"></a>类似计算属性。推荐里面传递一个形参的写法，不容易出错</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  isAdult: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.age &gt;= <span class="number">18</span> ? <span class="string">'成年人'</span> : <span class="string">'未成年'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 直接获取</span></span><br><span class="line">&lt;div&gt;&#123;&#123;userStore.isAdult&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="调用本模块其他getters"><a href="#调用本模块其他getters" class="headerlink" title="调用本模块其他getters"></a>调用本模块其他getters</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  isAdult: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.age &gt;= <span class="number">18</span> ? <span class="string">'成年人'</span> : <span class="string">'未成年'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  msg: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// msg这个getter访问了自身的getter（isAdult）</span></span><br><span class="line">    <span class="keyword">return</span> state.userName + state.isAdult</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="getters传参"><a href="#getters传参" class="headerlink" title="getters传参"></a>getters传参</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  isAdmin: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果getter里面是返回的函数，那么它就可以传参数了</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">name</span>) =&gt;</span> name === <span class="string">'admin'</span> ? <span class="string">'是管理员'</span> : <span class="string">'不是管理员'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">&#123;&#123;userStore.isAdmin&#125;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="调用其他store里面的getter"><a href="#调用其他store里面的getter" class="headerlink" title="调用其他store里面的getter"></a>调用其他store里面的getter</h6><p>商品模块goods.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line">​</span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="comment">// 第二个参数是配置对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useGoods = defineStore(<span class="string">'goods'</span>, &#123;</span><br><span class="line">  <span class="comment">// state是一个函数，返回一个对象</span></span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      goodsName: <span class="string">'iphone'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    newIphone: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.goodsName + <span class="string">' 14 pro'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>想在user模块的getter中去获取goods模块的newIphone这个getter<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useGoods &#125; <span class="keyword">from</span> <span class="string">'./goods.js'</span></span><br><span class="line"><span class="comment">// ..........</span></span><br><span class="line">getters: &#123;</span><br><span class="line">    info: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 获取goods模块的store</span></span><br><span class="line">      <span class="keyword">const</span> goodsStore = useGoods()</span><br><span class="line">      <span class="keyword">return</span> state.userName + <span class="string">'买了'</span> + goodsStore.newIphone</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">actions: &#123;</span><br><span class="line">  <span class="comment">// 这里的方法要写成普通函数，因为里面需要通过this去访问state里面的数据</span></span><br><span class="line">  changeNameAsync (newName) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// actions里面可以访问state</span></span><br><span class="line">      <span class="keyword">this</span>.userName = newName</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h5><p>在实际开发中，不可能把多个模块的数据都定义到一个store中，而是一个模块对应一个store，最后通过一个根store进行整合</p>
<h6 id="随便建立两个store，并导出"><a href="#随便建立两个store，并导出" class="headerlink" title="随便建立两个store，并导出"></a>随便建立两个store，并导出</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 模块一</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> useUserStore = defineStore(<span class="string">'user'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">'haha'</span>,</span><br><span class="line">      age: <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUserStore</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 模块二</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> useCounterStore = defineStore(<span class="string">'user'</span>, &#123;</span><br><span class="line">  state: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUserStore</span><br></pre></td></tr></table></figure>
<h6 id="新建store-index-js"><a href="#新建store-index-js" class="headerlink" title="新建store/index.js"></a>新建store/index.js</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useUserStore <span class="keyword">from</span> <span class="string">'./user'</span></span><br><span class="line"><span class="keyword">import</span> useCounterStore <span class="keyword">from</span> <span class="string">'./counter'</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 统一导出useStore方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useStore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    user: useUserStore(),</span><br><span class="line">    counter: useCounterStore(),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="组件中使用"><a href="#组件中使用" class="headerlink" title="组件中使用"></a>组件中使用</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">'pinia'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> useStore <span class="keyword">from</span> <span class="string">'./store'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> &#123; counter &#125; = useStore()</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="comment">// 使用storeToRefs可以保证解构出来的数据也是响应式的</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> &#123; count &#125; = storeToRefs(counter)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

        
    </section>
</article>





<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "7fbe80427f54741e289f",
        clientSecret: "f34ed5fd92e54c9000bd37ba951948cb939deff5",
        repo: "sanonz.github.io",
        owner: "sanonz",
        admin: ["sanonz"],
        id: "2023/05/15/v3",
        distractionFreeMode: true,
        title: "vue3和vue2的区别整理",
        body: "http://www.shuy.cc/2023/05/15/v3/",
        labels: []
    }).render('comments');
    </script>
</div>


        </div>
        <footer class="footer">
    Copyright © Aaron All Rights Reserved 京ICP备17007771号-1
</footer>

    </main>

    <script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle('normal', slideDone);
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp('normal', slideDone);
            }, 3000);
        }

        function slideDone() {
            if (nodes.navInner.css('display') !== 'none') {
                nodes.navInner.css('display', '');
            }
        }

        $(window).on('resize', function() {
            console.log($(this).width())
            if ($(this).width() > 960) {
                nodes.navInner.css('display', '');
            }
        });
    });
    </script>
    
        <script src="/js/scrollspy.min.js"></script>
        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});

        $(window).on('resize', function() {
            var hw = $('#header').width();
            var ww = $('#wrapper').width();
            var space = ($(this).width() - hw - ww) / 2 / 2;

            var pageprev = $('#pageprev');
            var pagenext = $('#pagenext');
            var avg = (pageprev.width() + pagenext.width()) / 2

            if(space > avg) {
                var len = space - avg / 2;
                // var styles = {position: 'fixed', top: '50%', marginTop: - (pageprev.width() + pagenext.width()) / 4}
                // pageprev.css($.extend({left: hw + len}, styles));
                // pagenext.css($.extend({right: len}, styles));
            } else {
                pageprev.removeAttr('style');
                // pagenext.removeAttr('style');
            }
        }).trigger('resize');
        </script>
    

</body>
</html>
