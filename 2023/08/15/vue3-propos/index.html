<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>vue3 通信方式 | 前端技术博客</title>
    <meta name="author" content="xiaosongread">
    <meta name="keywords" content="小宋 抿圪斗前端 前端 前端博客 框架 工程 css html js node markdown npm webpack">
    <meta name="description" content="本文会涉及的知识点：Propsemitsexpose / refv-model插槽 slotprovide / inject总线 busgetCurrentInstanceVuexPiniamitt.js(本文测试代码)[https://github.com/xiaosongread/vue3-template]Props父组件向子组件传递数据，子组件通过 props 接收数据。props 文档父组件123456789101112// Parent.vu...">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="/atom.xml" title="前端技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    <link rel="stylesheet" href="/css/style.css">

    <!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
</head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">前端技术博客</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">列表</span>
            </a>
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/categories/css-end/">
                <span class="nav-text">css</span>
            </a>
        
            <a class="nav-item" href="/categories/js-end/">
                <span class="nav-text">js</span>
            </a>
        
            <a class="nav-item" href="/categories/gc-end/">
                <span class="nav-text">工程</span>
            </a>
        
            <a class="nav-item" href="/categories/sh-end/">
                <span class="nav-text">日常</span>
            </a>
        
            <a class="nav-item" href="/categories/my-end/">
                <span class="nav-text">关于我</span>
            </a>
        
    </nav>
</div>

    
<aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Props"><span class="toc-number">1.</span> <span class="toc-text">Props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#emits"><span class="toc-number">2.</span> <span class="toc-text">emits</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#expose-ref"><span class="toc-number">3.</span> <span class="toc-text">expose/ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#v-model"><span class="toc-number">4.</span> <span class="toc-text">v-model</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单值的情况"><span class="toc-number">4.1.</span> <span class="toc-text">单值的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多个-v-model-绑定"><span class="toc-number">4.2.</span> <span class="toc-text">多个 v-model 绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#v-model-修饰符"><span class="toc-number">4.3.</span> <span class="toc-text">v-model 修饰符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插槽-slot"><span class="toc-number">5.</span> <span class="toc-text">插槽 slot</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#默认插槽"><span class="toc-number">5.1.</span> <span class="toc-text">默认插槽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#具名插槽"><span class="toc-number">5.2.</span> <span class="toc-text">具名插槽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#作用域插槽"><span class="toc-number">5.3.</span> <span class="toc-text">作用域插槽</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#provide-inject"><span class="toc-number">6.</span> <span class="toc-text">provide / inject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总线-bus"><span class="toc-number">7.</span> <span class="toc-text">总线 bus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getCurrentInstance"><span class="toc-number">8.</span> <span class="toc-text">getCurrentInstance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vuex"><span class="toc-number">9.</span> <span class="toc-text">Vuex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pinia"><span class="toc-number">10.</span> <span class="toc-text">Pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mitt-js"><span class="toc-number">11.</span> <span class="toc-text">mitt.js</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-number">11.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用"><span class="toc-number">11.2.</span> <span class="toc-text">使用</span></a></li></ol></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            vue3 通信方式
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://www.shuy.cc/2023/08/15/vue3-propos/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2023-08-15T14:00:01.000Z" itemprop="datePublished">2023-08-15</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>本文会涉及的知识点：</p>
<ul>
<li><a href="#Props">Props</a></li>
<li><a href="#emits">emits</a></li>
<li><a href="#expose/ref">expose / ref</a></li>
<li><a href="#v-model">v-model</a></li>
<li><a href="#插槽 slot">插槽 slot</a></li>
<li><a href="#provide / inject">provide / inject</a></li>
<li><a href="#总线 bus">总线 bus</a></li>
<li><a href="#getCurrentInstance">getCurrentInstance</a></li>
<li><a href="#Vuex">Vuex</a></li>
<li><a href="#Pinia">Pinia</a></li>
<li><a href="#mitt.js">mitt.js</a></li>
</ul>
<a id="more"></a>
<p>(本文测试代码)[<a href="https://github.com/xiaosongread/vue3-template]" target="_blank" rel="noopener">https://github.com/xiaosongread/vue3-template]</a></p>
<h3 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h3><p>父组件向子组件传递数据，子组件通过 props 接收数据。</p>
<p><a href="https://v3.cn.vuejs.org/guide/component-props.html" target="_blank" rel="noopener">props 文档</a></p>
<p><strong>父组件</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 使用子组件 --&gt;</span><br><span class="line">  &lt;Child :msg=<span class="string">"message"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">' // 引入子组件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let message = '</span>雷猴<span class="string">'</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>子组件</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;&#123; msg &#125;&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps(&#123;</span><br><span class="line">  msg: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(props.msg) <span class="comment">// 在 js 里需要使用 props.xxx 的方式使用。在 html 中使用不需要 props</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 script setup 中必须使用 defineProps API 来声明 props，它具备完整的推断并且在 script setup 中是直接可用的。</p>
<p>在 script setup 中，defineProps 不需要另外引入。</p>
<p>props 其实还能做很多事情，比如：<br>设置默认值 default ，<br>类型验证 type ，<br>要求必传 required ，<br>自定义验证函数 validator 等等。</p>
<h3 id="emits"><a href="#emits" class="headerlink" title="emits"></a>emits</h3><p>子组件通知父组件触发一个事件，并且可以传值给父组件。（简称：子传父）</p>
<p><a href="https://v3.cn.vuejs.org/guide/migration/emits-option.html" target="_blank" rel="noopener">emits 文档</a><br><strong>父组件</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;父组件：&#123;&#123; message &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;!-- 自定义 changeMsg 事件 --&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Child @changeMsg="changeMessage" /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let message = ref('</span>雷猴<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 更改 message 的值，data是从子组件传过来的</span></span><br><span class="line"><span class="string">function changeMessage(data) &#123;</span></span><br><span class="line"><span class="string">  message.value = data</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>子组件</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    子组件：&lt;button @click=<span class="string">"handleClick"</span>&gt;子组件的按钮&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 注册一个自定义事件名，向上传递时告诉父组件要触发的事件。</span></span><br><span class="line"><span class="regexp">const emit = defineEmits(['changeMsg'])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function handleClick() &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 参数1：事件名</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 参数2：传给父组件的值</span></span><br><span class="line"><span class="regexp">  emit('changeMsg', '鲨鱼辣椒')</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></p>
<p>和 props 一样，在 script setup 中必须使用 defineEmits API 来声明 emits，它具备完整的推断并且在 script setup 中是直接可用的。</p>
<h3 id="expose-ref"><a href="#expose-ref" class="headerlink" title="expose/ref"></a>expose/ref</h3><p>子组件可以通过 expose 暴露自身的方法和数据。</p>
<p>父组件通过 ref 获取到子组件并调用其方法或访问数据。</p>
<p><a href="https://v3.cn.vuejs.org/guide/component-basics.html#%E5" target="_blank" rel="noopener">expose 文档</a></p>
<p><strong>父组件</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;父组件：拿到子组件的message数据：&#123;&#123; msg &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button @click="callChildFn"&gt;调用子组件的方法&lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;hr&gt;</span><br><span class="line"></span><br><span class="line">  &lt;Child ref=<span class="string">"com"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref, onMounted &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const com = ref(null) // 通过 模板ref 绑定子组件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const msg = ref('</span><span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">onMounted(() =&gt; &#123;</span></span><br><span class="line"><span class="string">  // 在加载完成后，将子组件的 message 赋值给 msg</span></span><br><span class="line"><span class="string">  msg.value = com.value.message</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function callChildFn() &#123;</span></span><br><span class="line"><span class="string">  // 调用子组件的 changeMessage 方法</span></span><br><span class="line"><span class="string">  com.value.changeMessage('</span>蒜头王八<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // 重新将 子组件的message 赋值给 msg</span></span><br><span class="line"><span class="string">  msg.value = com.value.message</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>子组件</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;子组件：&#123;&#123; message &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message = ref(<span class="string">'蟑螂恶霸'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeMessage</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  message.value = data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 defineExpose 向外暴露指定的数据和方法</span></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  message,</span><br><span class="line">  changeMessage</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 script setup 中，defineExpose 不需要另外引入。</p>
<h3 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h3><p>v-model 是 Vue 的一个语法糖。</p>
<h4 id="单值的情况"><a href="#单值的情况" class="headerlink" title="单值的情况"></a>单值的情况</h4><p>组件上的 v-model 使用 modelValue 作为 prop 和 update:modelValue 作为事件。</p>
<p><a href="https://v3.cn.vuejs.org/api/directives.html#v-model" target="_blank" rel="noopener">v-model 参数文档</a></p>
<p><strong>父组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child v-model=<span class="string">"message"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const message = ref('</span>雷猴<span class="string">')</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>子组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div @click=<span class="string">"handleClick"</span>&gt;&#123;&#123;modelValue&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps([</span><br><span class="line">  <span class="string">'modelValue'</span> <span class="comment">// 接收父组件使用 v-model 传进来的值，必须用 modelValue 这个名字来接收</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits([<span class="string">'update:modelValue'</span>]) <span class="comment">// 必须用 update:modelValue 这个名字来通知父组件修改值</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 参数1：通知父组件修改值的方法名</span></span><br><span class="line">  <span class="comment">// 参数2：要修改的值</span></span><br><span class="line">  emit(<span class="string">'update:modelValue'</span>, <span class="string">'喷射河马'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>子组件你也可以这么简单写：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div @click=<span class="string">"$emit('update:modelValue', '喷射河马')"</span>&gt;&#123;&#123;modelValue&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps([</span><br><span class="line">  <span class="string">'modelValue'</span> <span class="comment">// 接收父组件使用 v-model 传进来的值，必须用 modelValue 这个名字来接收</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="多个-v-model-绑定"><a href="#多个-v-model-绑定" class="headerlink" title="多个 v-model 绑定"></a>多个 v-model 绑定</h4><p><strong>父组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child v-model:msg1=<span class="string">"message1"</span> v-model:msg2=<span class="string">"message2"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const message1 = ref('</span>雷猴<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const message2 = ref('</span>蟑螂恶霸<span class="string">')</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>子组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;<span class="xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"changeMsg1"</span>&gt;</span>修改msg1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span> &#123;&#123;msg1&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  &lt;div&gt;&lt;button @click="changeMsg2"&gt;修改msg2&lt;/</span>button&gt; &#123;&#123;msg2&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps(&#123;</span><br><span class="line">  msg1: <span class="built_in">String</span>,</span><br><span class="line">  msg2: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits([<span class="string">'update:msg1'</span>, <span class="string">'update:msg2'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeMsg1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  emit(<span class="string">'update:msg1'</span>, <span class="string">'鲨鱼辣椒'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeMsg2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  emit(<span class="string">'update:msg2'</span>, <span class="string">'蝎子莱莱'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="v-model-修饰符"><a href="#v-model-修饰符" class="headerlink" title="v-model 修饰符"></a>v-model 修饰符</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child v-model.uppercase=<span class="string">"message"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const message = ref('</span>hello<span class="string">')</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123;modelValue&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps([</span><br><span class="line">  <span class="string">'modelValue'</span>,</span><br><span class="line">  <span class="string">'modelModifiers'</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits([<span class="string">'update:modelValue'</span>])</span><br><span class="line"></span><br><span class="line">onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断有没有 uppercase 修饰符，有的话就执行 toUpperCase() 方法</span></span><br><span class="line">  <span class="keyword">if</span> (props.modelModifiers.uppercase) &#123;</span><br><span class="line">    emit(<span class="string">'update:modelValue'</span>, props.modelValue.toUpperCase())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="插槽-slot"><a href="#插槽-slot" class="headerlink" title="插槽 slot"></a>插槽 slot</h3><p>插槽可以理解为传一段 HTML 片段给子组件。子组件将 slot 元素作为承载分发内容的出口。</p>
<h4 id="默认插槽"><a href="#默认插槽" class="headerlink" title="默认插槽"></a>默认插槽</h4><p>插槽的基础用法非常简单，只需在 子组件 中使用 slot 标签，就会将父组件传进来的 HTML 内容渲染出来。</p>
<p><a href="https://cn.vuejs.org/guide/components/slots.html" target="_blank" rel="noopener">默认插槽 文档</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child&gt;</span><br><span class="line">    &lt;div&gt;雷猴啊&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Child&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;slot&gt;&lt;<span class="regexp">/slot&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h4><p>具名插槽 就是在 默认插槽 的基础上进行分类，可以理解为对号入座。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child&gt;</span><br><span class="line">    &lt;template v-slot:monkey&gt;</span><br><span class="line">      &lt;div&gt;雷猴啊&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;button&gt;鲨鱼辣椒&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Child&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 默认插槽 --&gt;</span><br><span class="line">    &lt;slot&gt;&lt;<span class="regexp">/slot&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- 具名插槽 --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;slot name="monkey"&gt;&lt;/</span>slot&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br></pre></td></tr></table></figure>
<p>父组件需要使用 template 标签，并在标签上使用 v-solt: + 名称 。</p>
<p>子组件需要在 slot 标签里用 name= 名称 对应接收。</p>
<p>这就是 对号入座。</p>
<blockquote>
<p>插槽内容的排版顺序，是 以子组件里的排版为准。</p>
</blockquote>
<h4 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h4><p>如果你用过 Element-Plus 这类 UI框架 的 Table ，应该就能很好的理解什么叫作用域插槽。</p>
<p><img src="/images/img-folder/2023/slot.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- v-slot=<span class="string">"&#123;scope&#125;"</span> 获取子组件传上来的数据 --&gt;</span><br><span class="line">  &lt;!-- :list=<span class="string">"list"</span> 把list传给子组件 --&gt;</span><br><span class="line">  &lt;Child v-slot=<span class="string">"&#123;scope&#125;"</span> :list=<span class="string">"list"</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;名字：&#123;&#123; scope.name &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;职业：&#123;&#123; scope.occupation &#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;hr&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Child&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const list = ref([</span></span><br><span class="line"><span class="string">  &#123; name: '</span>雷猴<span class="string">', occupation: '</span>打雷<span class="string">'&#125;,</span></span><br><span class="line"><span class="string">  &#123; name: '</span>鲨鱼辣椒<span class="string">', occupation: '</span>游泳<span class="string">'&#125;,</span></span><br><span class="line"><span class="string">  &#123; name: '</span>蟑螂恶霸<span class="string">', occupation: '</span>扫地<span class="string">'&#125;,</span></span><br><span class="line"><span class="string">])</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 用 :scope=<span class="string">"item"</span> 返回每一项 --&gt;</span><br><span class="line">    &lt;slot v-<span class="keyword">for</span>=<span class="string">"item in list"</span> :scope=<span class="string">"item"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">const</span> props = defineProps(&#123;</span><br><span class="line">  list: &#123;</span><br><span class="line">    type: <span class="built_in">Array</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide / inject"></a>provide / inject</h3><p>遇到多层传值时，使用 props 和 emit 的方式会显得比较笨拙。这时就可以用 provide 和 inject 了。<br>provide 是在父组件里使用的，可以往下传值。<br>inject 是在子(后代)组件里使用的，可以往上取值。</p>
<blockquote>
<p>无论组件层次结构有多深，父组件都可以作为其所有子组件的依赖提供者。</p>
</blockquote>
<p><a href="https://cn.vuejs.org/guide/components/provide-inject.html#prop-drilling" target="_blank" rel="noopener">provide / inject 文档</a></p>
<p><img src="https://cn.vuejs.org/assets/provide-inject.3e0505e4.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Child&gt;&lt;<span class="regexp">/Child&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, provide, readonly &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./components/Child.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = ref(<span class="string">'猛虎下山'</span>)</span><br><span class="line"><span class="keyword">const</span> msg = ref(<span class="string">'雷猴'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用readonly可以让子组件无法直接修改，需要调用provide往下传的方法来修改</span></span><br><span class="line">provide(<span class="string">'name'</span>, readonly(name))</span><br><span class="line"></span><br><span class="line">provide(<span class="string">'msg'</span>, msg)</span><br><span class="line"></span><br><span class="line">provide(<span class="string">'changeName'</span>, (value) =&gt; &#123;</span><br><span class="line">  name.value = value</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div&gt;msg: &#123;&#123; msg &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;name: &#123;&#123;name&#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;button @click=<span class="string">"handleClick"</span>&gt;修改&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; inject &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const name = inject('name', 'hello') /</span><span class="regexp">/ 看看有没有值，没值的话就适用默认值（这里默认值是hello）</span></span><br><span class="line"><span class="regexp">const msg = inject('msg')</span></span><br><span class="line"><span class="regexp">const changeName = inject('changeName')</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function handleClick() &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 这样写不合适，因为vue里推荐使用单向数据流，当父级使用readonly后，这行代码是不会生效的。没使用之前才会生效。</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ name.value = '雷猴'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 正确的方式</span></span><br><span class="line"><span class="regexp">  changeName('虎躯一震')</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 因为 msg 没被 readonly 过，所以可以直接修改值</span></span><br><span class="line"><span class="regexp">  msg.value = '世界'</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>provide 可以配合 readonly 一起使用。<br>provide 和 inject 其实主要是用在深层关系中传值</p>
</blockquote>
<h3 id="总线-bus"><a href="#总线-bus" class="headerlink" title="总线 bus"></a>总线 bus</h3><p>在 Vue2 有总线传值的方法，我们在 Vue3 中也可以自己模拟。<br>这个方式其实有点像 Vuex 或者 Pinia 那样，弄一个独立的工具出来专门控制数据。<br>但和 Vuex 或 Pinia 相比，我们自己写的这个方法并没有很好的数据跟踪之类的特性。</p>
<p><strong>原理</strong><br>我们创建一个 Bus.js 文件，用来控制数据和注册事件的。</p>
<p>Bus.js 里有一个 Bus 类</p>
<ul>
<li>eventList 是必须项，用来存放事件列表的。</li>
<li>constructor 里除了 eventList 外，其他都是自定义数据，公共数据就是存在这里的。</li>
<li>$on 方法用来注册事件。</li>
<li>$emit 方法可以调用 $on 里的事件。</li>
<li>$off 方法可以注销 eventList 里的事件。</li>
</ul>
<p>然后需要用到总线的组件，都导入 Bus.js ，就可以共同操作一份数据了。</p>
<p><strong>Bus.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bus.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">"vue"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bus</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// 收集订阅信息，调度中心</span></span><br><span class="line">    <span class="keyword">this</span>.evenList = &#123;&#125;, <span class="comment">// 事件列表，这项是必须的</span></span><br><span class="line">    <span class="comment">// 下面都是自定义值</span></span><br><span class="line">    <span class="keyword">this</span>.msg = ref(<span class="string">'这是一条总线的信息'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  $on(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.evenList[name] = <span class="keyword">this</span>.evenList[name] || []</span><br><span class="line">    <span class="keyword">this</span>.evenList[name].push(fn)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.evenList)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  $emit(name, data) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.evenList[name]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.evenList[name].forEach(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        fn(data)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 取消调用</span></span><br><span class="line">  $off(name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.evenList[name]) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="keyword">this</span>.evenList[name]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Bus()</span><br></pre></td></tr></table></figure>
<p><strong>parant.vue</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;Bus&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      父组件：</span></span><br><span class="line"><span class="regexp">      &lt;span style="margin-right: 30px;"&gt;message: &#123;&#123; message &#125;&#125;&lt;/</span>span&gt;</span><br><span class="line">      &lt;span&gt;msg: &#123;&#123; msg &#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">    &lt;Child /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> Bus <span class="keyword">from</span> <span class="string">"../utils/Bus"</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"../components/bus.vue"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> msg = ref(Bus.msg)</span><br><span class="line"><span class="keyword">const</span> message = ref(<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用监听的写法</span></span><br><span class="line">Bus.$on(<span class="string">'changeMsg'</span>, data =&gt; &#123;</span><br><span class="line">  message.value = data</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>bus.vue</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// child</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    子组件：</span><br><span class="line">    &lt;button @click=<span class="string">"handleBusEmit"</span>&gt;触发Bus.$emit&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button @click="changeBusMsg"&gt;修改总线里面的msg&lt;/</span>button&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> Bus <span class="keyword">from</span> <span class="string">"../utils/Bus"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleBusEmit</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  Bus.$emit(<span class="string">'changeMsg'</span>, <span class="string">'触发emit并且修改了msg数据'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeBusMsg</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  Bus.msg.value = <span class="string">'子组件修改了总线的值'</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="getCurrentInstance"><a href="#getCurrentInstance" class="headerlink" title="getCurrentInstance"></a>getCurrentInstance</h3><p>getcurrentinstance 是 vue 提供的一个方法，支持访问内部组件实例。</p>
<blockquote>
<p>getCurrentInstance 只暴露给高阶使用场景，典型的比如在库中。<br>强烈反对在应用的代码中使用 getCurrentInstance。请不要把它当作在组合式 API 中获取 this 的替代方案来使用。</p>
</blockquote>
<p>说白了，这个方法 适合在开发组件库的情况下使用，不适合日常业务开发中使用。<br>getCurrentInstance <strong>只能在 setup 或生命周期钩子中调用。</strong></p>
<p>在 script setup 中，我模拟了类似 $parent 和 $children 的方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;父组件 message 的值: &#123;&#123; message &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;button @click="handleClick"&gt;获取子组件&lt;/</span>button&gt;</span><br><span class="line">  &lt;Child&gt;&lt;<span class="regexp">/Child&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Child&gt;&lt;/</span>Child&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; ref, getCurrentInstance, onMounted &#125; from 'vue'</span></span><br><span class="line"><span class="regexp">import Child from './</span>components/Child.vue<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const message = ref('</span>雷猴啊<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let instance = null</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">onMounted(() =&gt; &#123;</span></span><br><span class="line"><span class="string">  instance = getCurrentInstance()</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 子组件列表</span></span><br><span class="line"><span class="string">let childrenList = []</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 注册组件</span></span><br><span class="line"><span class="string">function registrationCom(com) &#123;</span></span><br><span class="line"><span class="string">  childrenList.push(com)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function handleClick() &#123;</span></span><br><span class="line"><span class="string">  if (childrenList.length &gt; 0) &#123;</span></span><br><span class="line"><span class="string">    childrenList.forEach(item =&gt; &#123;</span></span><br><span class="line"><span class="string">      console.log('</span>组件实例：<span class="string">', item)</span></span><br><span class="line"><span class="string">      console.log('</span>组件名(name)：<span class="string">', item.type.name)</span></span><br><span class="line"><span class="string">      console.log('</span>组件输入框的值：<span class="string">', item.devtoolsRawSetupState.inputValue)</span></span><br><span class="line"><span class="string">      console.log('</span>---------------------------------------<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div&gt;----------------------------&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    子组件：&lt;button @click="handleClick"&gt;获取父组件的值&lt;/</span>button&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> v-model=<span class="string">"inputValue"</span>&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'ccccc'</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import &#123; getCurrentInstance, onMounted, nextTick, ref &#125; from 'vue'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const inputValue = ref('')</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">let instance = null</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">onMounted(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  instance = getCurrentInstance()</span></span><br><span class="line"><span class="regexp">  nextTick(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    instance.parent.devtoolsRawSetupState.registrationCom(instance)</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function handleClick() &#123;</span></span><br><span class="line"><span class="regexp">  let msg = instance.parent.devtoolsRawSetupState.message</span></span><br><span class="line"><span class="regexp">  msg.value = '哈哈哈哈哈哈'</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><p>Vuex 主要解决 跨组件通信 的问题。</p>
<p>在 Vue3 中，需要使用 Vuex v4.x 版本。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在 store/index.js 下输入以上内容。</p>
<ul>
<li>state：数据仓库，用来存数据的。</li>
<li>getters：获取数据的，有点像 computed 的用法(个人觉得)。</li>
<li>mutations: 更改 state 数据的方法都要写在 mutations 里。</li>
<li>actions：异步的方法都写在这里，但最后还是需要通过 mutations 来修改 state 的数据。</li>
<li>modules：分包。如果项目比较大，可以将业务拆散成独立模块，然后分文件管理和存放。</li>
</ul>
<p>然后在 src/main.js 中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.css'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(router).use(store).mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/modules/app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; getListData &#125; <span class="keyword">from</span> <span class="string">"@/api/login"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespaced: <span class="literal">true</span>,</span><br><span class="line">  state: &#123;</span><br><span class="line">    sidebar: <span class="string">'123'</span>,</span><br><span class="line">    listData: []</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  mutations: &#123;</span><br><span class="line">    TOGGLE_SIDEBAR: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      state.sidebar = <span class="string">'2222'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    SET_LIST_DATA: <span class="function">(<span class="params">state, listData</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'listdata-state:'</span>, listData)</span><br><span class="line">      state.listData = listData</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  actions: &#123;</span><br><span class="line">    toggleSideBar(&#123; commit &#125;) &#123;</span><br><span class="line">      commit(<span class="string">'TOGGLE_SIDEBAR'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> getListDataAction(&#123; commit, state &#125;, params) &#123;</span><br><span class="line">      <span class="keyword">await</span> getListData()</span><br><span class="line">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 处理返回结果，例如转换成对应的符合业务需求的数据结构</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"接口数据:"</span>, res)</span><br><span class="line">          commit(<span class="string">"SET_LIST_DATA"</span>, res);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 处理异常，即异常状态下数据应该是什么样子</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getters.js</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  sidebar: <span class="function"><span class="params">state</span> =&gt;</span> state.app.sidebar,</span><br><span class="line">  token: <span class="function"><span class="params">state</span> =&gt;</span> state.user.token,</span><br><span class="line">  listData: <span class="function"><span class="params">state</span> =&gt;</span> state.app.listData</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">'./getters'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> modulesFiles = <span class="keyword">import</span>.meta.glob(<span class="string">'./modules/*.js'</span>,&#123; <span class="attr">eager</span>: <span class="literal">true</span> &#125;); <span class="comment">// 异步方式</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> modules = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(modulesFiles)) &#123;</span><br><span class="line">  <span class="keyword">var</span> moduleName = key.replace(<span class="regexp">/^\.\/(.*)\.\w+$/</span>, <span class="string">'$1'</span>);</span><br><span class="line">  <span class="keyword">const</span> name = moduleName.split(<span class="string">'/'</span>)[<span class="number">1</span>]</span><br><span class="line">  modules[name] = value.default</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">  modules,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<h3 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h3><p>Pinia 是最近比较火热的一个工具，也是用来处理 跨组件通信 的，极大可能成为 Vuex 5 。</p>
<p><a href="https://pinia.vuejs.org/zh/api/modules/pinia.html" target="_blank" rel="noopener">Pinia 文档</a></p>
<p>从我使用 Pinia 一阵后的角度来看，Pinia 跟 Vuex 相比有以下优点：</p>
<ul>
<li>调用时代码跟简洁了。</li>
<li>对 TS 更友好。</li>
<li>合并了 Vuex 的 Mutation 和 Action 。天然的支持异步了。</li>
<li>天然分包。</li>
<li>除此之外，Pinia 官网还说它适用于 Vue2 和 Vue3。</li>
</ul>
<p>Pinia 简化了状态管理模块，只用这3个东西就能应对日常大多任务。</p>
<ul>
<li>state：存储数据的仓库</li>
<li>getters：获取和过滤数据（跟 computed 有点像）</li>
<li>actions：存放 “修改 state ”的方法</li>
</ul>
<h3 id="mitt-js"><a href="#mitt-js" class="headerlink" title="mitt.js"></a>mitt.js</h3><p>我们前面用到的 总线 Bus 方法，其实和 mitt.js 有点像，但 mitt.js 提供了更多的方法。<br>比如：</p>
<ul>
<li>on：添加事件</li>
<li>emit：执行事件</li>
<li>off：移除事件</li>
<li>clear：清除所有事件</li>
</ul>
<p>mitt.js 不是专门给 Vue 服务的，但 Vue 可以利用 mitt.js 做跨组件通信。</p>
<p><a href="https://github.com/developit/mitt" target="_blank" rel="noopener">github 地址</a></p>
<p><a href="https://www.npmjs.com/package/mitt" target="_blank" rel="noopener">npm 地址</a></p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mitt</span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>我模拟一下 总线Bus 的方式。<br>我在同级目录创建3个文件用作模拟。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Parent.vue</span><br><span class="line">Child.vue</span><br><span class="line">Bus.js</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bus.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mitt <span class="keyword">from</span> <span class="string">'mitt'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mitt()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    Mitt</span><br><span class="line">    &lt;Child /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./Child.vue'</span></span><br><span class="line"><span class="keyword">import</span> Bus <span class="keyword">from</span> <span class="string">'./Bus.js'</span></span><br><span class="line"></span><br><span class="line">Bus.on(<span class="string">'sayHello'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">'雷猴啊'</span>))</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Child.vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    Child：&lt;button @click=<span class="string">"handleClick"</span>&gt;打声招呼&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script setup&gt;</span></span><br><span class="line"><span class="regexp">import Bus from './</span>Bus.js<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function handleClick() &#123;</span></span><br><span class="line"><span class="string">  Bus.emit('</span>sayHello<span class="string">')</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时，点击 Child.vue 上的按钮，在控制台就会执行在 Parent.vue 里定义的方法。</p>
<p>mitt.js 的用法其实很简单，建议跟着 <a href="https://www.npmjs.com/package/mitt" target="_blank" rel="noopener">官方示例</a> 敲一下代码，几分钟就上手了。</p>

        
    </section>
</article>





<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "7fbe80427f54741e289f",
        clientSecret: "f34ed5fd92e54c9000bd37ba951948cb939deff5",
        repo: "sanonz.github.io",
        owner: "sanonz",
        admin: ["sanonz"],
        id: "2023/08/15/vue3-propos",
        distractionFreeMode: true,
        title: "vue3 通信方式",
        body: "http://www.shuy.cc/2023/08/15/vue3-propos/",
        labels: []
    }).render('comments');
    </script>
</div>


        </div>
        <footer class="footer">
    Copyright © Aaron All Rights Reserved 京ICP备17007771号-1
</footer>

    </main>

    <script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle('normal', slideDone);
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp('normal', slideDone);
            }, 3000);
        }

        function slideDone() {
            if (nodes.navInner.css('display') !== 'none') {
                nodes.navInner.css('display', '');
            }
        }

        $(window).on('resize', function() {
            console.log($(this).width())
            if ($(this).width() > 960) {
                nodes.navInner.css('display', '');
            }
        });
    });
    </script>
    
        <script src="/js/scrollspy.min.js"></script>
        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});

        $(window).on('resize', function() {
            var hw = $('#header').width();
            var ww = $('#wrapper').width();
            var space = ($(this).width() - hw - ww) / 2 / 2;

            var pageprev = $('#pageprev');
            var pagenext = $('#pagenext');
            var avg = (pageprev.width() + pagenext.width()) / 2

            if(space > avg) {
                var len = space - avg / 2;
                // var styles = {position: 'fixed', top: '50%', marginTop: - (pageprev.width() + pagenext.width()) / 4}
                // pageprev.css($.extend({left: hw + len}, styles));
                // pagenext.css($.extend({right: len}, styles));
            } else {
                pageprev.removeAttr('style');
                // pagenext.removeAttr('style');
            }
        }).trigger('resize');
        </script>
    

</body>
</html>
